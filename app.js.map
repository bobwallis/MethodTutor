{"version":3,"names":["ready","fn","document","readyState","addEventListener","ServiceWorker","load","navigator","serviceWorker","register","$document_on","eventNames","elementSelector","handler","split","forEach","eventName","e","target","el","closest","call","fieldMap","parseCurrentHash","queryString","window","location","hash","query","pairs","substring","i","length","pair","decodeURIComponent","Hash","field","currentHash","value","dispatchEvent","Event","bubbles","title","notation","stage","querySelector","hashString","id","filteredCurrentHash","Object","entries","filter","keys","fromEntries","map","key","encodeURIComponent","join","history","replaceState","undefined","getElementById","ruleoffs","allowMethodSelection","about","overlay","createElement","className","body","insertBefore","aboutOpen","toggleAbout","closeAbout","openAbout","matches","this","parentNode","classList","remove","add","previousElementSibling","nextElementSibling","radios","querySelectorAll","node","parentElement","firstChild","nodeType","nextSibling","practice_chooser_bell","newStage","parseInt","currentPlaceBell","event","MouseEvent","view","cancelable","sectionTitle","innerText","practice_chooser_container","practice_chooser_name","practice_chooser_stage","practice_chooser_notation","practice_chooser_ruleOffs","practice_chooser_allowMethodSelection","practice_chooser_help","searchResults","prevButton","style","pointerEvents","opacity","display","innerHTML","searchCount","activeSearchCount","thisSearchCount","fetch","then","r","Error","json","data","fragment","results","ruleOffs","from","every","marginBottom","catch","console","log","nextButton","pnChange","titleChange","focus","dataset","contains","activeElement","preventDefault","searchResults_li","children","active_searchResults_li","target_searchResults_li","previousSibling","PlaceNotation","bellToCharMap","bellToChar","bell","charToBell","ch","isNaN","indexOf","expand","fullNotation","stageText","toUpperCase","replace","trim","Math","max","apply","b","match","expandHalf","splitOnComma","s","reduce","prev","cur","charAt","test","explode","piece","affected","sort","a","concat","f","notationReversed","reverse","m","p1","firstDot","firstX","parse","j","k","l","parsed","exploded","xPermutation","Array","push","permutation","notationCharacters","to","lowestBell","min","slice","stationary","implode","notationArray","rounds","row","backRounds","queens","mid","ceil","kings","floor","tittums","whittingtons","rowsEqual","row1","row2","allRows","startRow","rows","iLim","permuted","p","cycles","cycle","calcRow","huntBells","start","end","hunts","Canvas","options","href","pixelRatio","scale","devicePixelRatio","canvas","setAttribute","width","height","element","context","getContext","setLineDash","fillText","prototype","type","prefix","dataAge","getElementsByTagName","getAttribute","LocalStorage","age","JSON","localStorage","getItem","setItem","stringify","removeItem","clear","cacheKey","RegExp","clearCache","getSetting","defaultSetting","setSetting","removeSetting","settingsKey","clearSettings","cacheAge","measureXAndYTextPadding","size","font","text","padding","getCache","random","round","textAlign","textBaseline","fillStyle","column","dim","imageData","getImageData","bottomOfText","topOfText","leftOfText","rightOfText","setCache","x","y","RingingPractice","container","finishRow","following","score","introduction","autostart","toString","buttons","thatsAll","hbIndicator","canvasWidth","offsetWidth","canvasHeight","offsetHeight","bellWidth","rowHeight","paddingForLeftMostPosition","clearLeft","clearWidth","appendChild","errorFlashes","controlsContainer","control_button","scoreboard","rowCount","errorCount","show","hide","reset","correct","error","errorFlash","setTimeout","pauseButton","pause","pauseFunction","going","canvasPaused","controls","deactivate","hidden","buttonsContainer","createTextNode","resumeCallback","activate","draw","unshift","callback","setup","buttonElements","button","currentRow","finished","blur","buttonFlash","fillTextCache_hbIndicator","char","cacheCanvas","hMetrics","MeasureCanvasTextOffset","fillTextCache_hIndicator","fillTextCache_bIndicator","placeStarts","fillTextCache_placeStarts","placeStartTextMetrics","strokeStyle","lines","color","lineWidth","beginPath","arc","PI","closePath","stroke","fillTextCache_guides","fillTextCache_introduction","strokeText","measureText","fillTextCache_thatsAll","thatsAllString","fillTextCache_thatsAllFinished","fillTextCache_messagesText","byRow","canvases","multiLineMatch","prop","messages","pos","multiLineMatchResult","xLim","fillTextCache_overlayMessagesText","overlayMessages","currentPos","nextPos","targetRow","dotY","previousTimestamp","currentRowAtTimeOfLastTargetRowSet","advance","direction","Android","buzz","rowMoveDuration","step","timestamp","redrawNeeded","rowsToMove","pow","requestAnimationFrame","comingFromPosition","goingToPosition","toI","fromI","currentRowCeil","currentRowFloor","clearRect","lineCap","moveTo","lineTo","drawImage","globalAlpha","lineJoin","fill","minOverlayMessage","maxOverlayMessage","left","down","right","changeSpeed","touch","touches","containerRect","getBoundingClientRect","posX","clientX","pageY","top","classes","practice_container","replaceWith","cloneNode","option_title","option_leadOrCourse","option_stage","option_notation","option_following","option_ruleOffs","option_lines"],"sources":["../src/js/lib/ready.js","../src/js/lib/ServiceWorker.js","../src/js/lib/$document_on.js","../src/js/ui/Hash.js","../src/js/ui/About.js","../src/js/ui/Sections.js","../src/js/ui/ChooseOptions.js","../src/js/ui/SelectMethod.js","../src/js/lib/PlaceNotation.js","../src/js/lib/Canvas.js","../src/js/lib/LocalStorage.js","../src/js/lib/MeasureCanvasTextOffset.js","../src/js/lib/RingingPractice.js","../src/js/ui/Tutor.js","../src/js/app.js"],"sourcesContent":["// Helper function that queues functions for execution once the DOM is ready\nvar ready = function( fn ) {\n    if( document.readyState != 'loading' ) {\n        fn();\n    }\n    else {\n        document.addEventListener( 'DOMContentLoaded', fn );\n    }\n};\nexport default ready;\n","// Service worker registration\nconst ServiceWorker = {\n    load() {\n        if ('serviceWorker' in navigator) {\n            navigator.serviceWorker.register('service-worker.js');\n        }\n    }\n};\nexport default ServiceWorker;\n","// ES module: simplified DOM event delegation\nexport default function $document_on(eventNames, elementSelector, handler) {\n    eventNames.split(' ').forEach(function(eventName) {\n        document.addEventListener(eventName, function(e) {\n            if (e.target) {\n                var el = e.target.closest(elementSelector);\n                if (el === null) return;\n                handler.call(el, e);\n            }\n        });\n    });\n}\n","import ready from '../lib/ready.js';\nimport $document_on from '../lib/$document_on.js';\n\nvar fieldMap;\n\nvar parseCurrentHash = function() {\n    var queryString = window.location.hash,\n        query = {},\n        pairs = (queryString[0] === '#' ? queryString.substring( 1 ) : queryString).split( '&' );\n    for( var i = 0; i < pairs.length; i++ ) {\n        var pair = pairs[i].split( '=' );\n        query[decodeURIComponent( pair[0] )] = decodeURIComponent( pair[1] || '' );\n    }\n    return query;\n};\n\nvar Hash = {\n    read: function() {\n        var currentHash = parseCurrentHash(),\n            field;\n        // Push the values in the hash into the relevant form fields\n        for( field in fieldMap ) {\n            if( typeof currentHash[field] !== 'undefined' && currentHash[field] !== '' ) {\n                fieldMap[field].value = currentHash[field];\n            }\n        }\n        // Trigger change events\n        for( field in fieldMap ) {\n            if( typeof currentHash[field] !== 'undefined' && currentHash[field] !== '' ) {\n                fieldMap[field].dispatchEvent( new Event( 'change', { bubbles: true } ) );\n            }\n        }\n        // If the method has been fully populated via the hash then move onto options\n        if( typeof currentHash.title !== 'undefined' && typeof currentHash.notation !== 'undefined' && typeof currentHash.stage !== 'undefined' ) {\n            document.querySelector( '#selectMethod .next_button button' ).dispatchEvent( new Event( 'click', { bubbles: true } ) );\n        }\n    },\n    update: function( e ) {\n        var currentHash = parseCurrentHash(),\n            hashString,\n            field;\n        // Read values in the fields into the hash if they are different or if the field is the one that changed\n        for( field in fieldMap ) {\n            if( fieldMap[field].id === e.target.id || typeof currentHash[field] !== 'undefined' ) {\n                currentHash[field] = fieldMap[field].value;\n            }\n        }\n        // Filter out empty options\n        var filteredCurrentHash = Object.entries( currentHash ).filter( function( e ) { return e[1]; } );\n        // Combine the fields back into a string\n        hashString = Object.keys( Object.fromEntries( filteredCurrentHash ) ).map( function( key ) { return key+'='+encodeURIComponent( currentHash[key] ); } ).join( '&' );\n        // Replace the hash\n        history.replaceState( undefined, undefined, '#'+hashString )\n    }\n};\n\nready( function() {\n    $document_on( 'change', 'select, input', Hash.update );\n    window.addEventListener( 'hashchange', Hash.read );\n    fieldMap = {\n        'title': document.getElementById( 'practice_chooser_name' ),\n        'stage': document.getElementById( 'practice_chooser_stage' ),\n        'notation': document.getElementById( 'practice_chooser_notation' ),\n        'ruleoffs': document.getElementById( 'practice_chooser_ruleOffs' ),\n        'allowMethodSelection': document.getElementById( 'practice_chooser_allowMethodSelection' )\n    };\n} );\n\nexport default Hash;\n","import ready from '../lib/ready.js';\n\nready(function() {\n    // Find the about element\n    var about = document.getElementById( 'about' );\n\n    // Create overlay element\n    var overlay = document.createElement( 'div' );\n    overlay.id = 'overlay';\n    overlay.className = 'hide';\n    document.body.insertBefore( overlay, about );\n\n    // Functions to open and close the about box\n    var aboutOpen = false;\n    var toggleAbout = function() {\n        aboutOpen? closeAbout() : openAbout();\n    };\n    var openAbout = function() {\n        overlay.className = 'active';\n        about.className   = 'active';\n        aboutOpen = true;\n    };\n    var closeAbout = function() {\n        overlay.className = 'hide';\n        about.className   = 'hide';\n        aboutOpen = false;\n    }\n\n    // Add event listeners\n    document.getElementById( 'aboutButton' ).addEventListener( 'click', toggleAbout );\n    overlay.addEventListener( 'click', toggleAbout );\n    document.getElementById( 'head' ).addEventListener( 'click', function( e ) {\n        if( !e.target.matches( '#aboutButton' ) ) {\n            closeAbout();\n        }\n    } );\n    document.body.addEventListener( 'keydown', function( e ) {\n        if( e.key === 'Escape' ) {\n            closeAbout();\n        }\n    } );\n});\n","import ready from '../lib/ready.js';\nimport $document_on from '../lib/$document_on.js';\n\nready(function() {\n    // Listen for clicks to the next / prev buttons\n    $document_on( 'click', '.prev_button button', function( e ) {\n        this.parentNode.parentNode.classList.remove( 'active' );\n        this.parentNode.parentNode.classList.remove( 'up' );\n        this.parentNode.parentNode.classList.add( 'down' );\n        this.parentNode.parentNode.previousElementSibling.classList.add( 'active' );\n        this.parentNode.parentNode.previousElementSibling.classList.remove( 'up' );\n        this.parentNode.parentNode.previousElementSibling.classList.remove( 'down' );\n    } );\n    $document_on( 'click', '.next_button button', function( e ) {\n        this.parentNode.parentNode.classList.remove( 'active' );\n        this.parentNode.parentNode.classList.add( 'up' );\n        this.parentNode.parentNode.classList.remove( 'down' );\n        this.parentNode.parentNode.nextElementSibling.classList.add( 'active' );\n        this.parentNode.parentNode.nextElementSibling.classList.remove( 'up' );\n        this.parentNode.parentNode.nextElementSibling.classList.remove( 'down' );\n    } );\n});\n","import ready from '../lib/ready.js';\n\nready(function() {\n    // Listen for changes to the pill selectors\n    var radios = document.querySelectorAll( 'ul.tab_group input[type=radio]' );\n    for( var i = 0; i < radios.length; i++ ) {\n        radios[i].addEventListener( 'click', function( e ) {\n            for( var node = e.target.parentElement.parentElement.firstChild; node && node.nodeType === 1; node = node.nextElementSibling || node.nextSibling ) {\n                node.classList.remove( 'active' );\n            }\n            e.target.parentElement.classList.add( 'active' );\n        } );\n    }\n\n    // Listen for changes to the stage and adjust the place bell selector\n    var practice_chooser_bell = document.getElementById( 'practice_chooser_bell' );\n    document.getElementById( 'practice_chooser_stage' ).addEventListener( 'change', function( e ) {\n        var newStage = parseInt( e.target.value, 10 ),\n            currentPlaceBell = parseInt( practice_chooser_bell.querySelector( 'li.active input' ).value, 10 );\n        // Change the selector to the current stage\n        practice_chooser_bell.className = 'tab_group _'+newStage;\n        // If the currently selected place bell has fallen off the end then reset to the heaviest bell available\n        if( newStage < currentPlaceBell ) {\n            var event = new MouseEvent( 'click', { view: window, bubbles: true, cancelable: true } );\n            practice_chooser_bell.querySelector( 'input#practice_chooser_bell_'+newStage ).dispatchEvent( event );\n        }\n    } );\n\n    // Listen for changes to the method name and set the title\n    var sectionTitle = document.querySelector( '#chooseOptions h3' );\n    document.getElementById( 'practice_chooser_name' ).addEventListener( 'change', function( e ) {\n            sectionTitle.innerText = e.target.value;\n    });\n} );\n","import ready from '../lib/ready.js';\nimport $document_on from '../lib/$document_on.js';\n\nready(function() {\n    var practice_chooser_container            = document.getElementById( 'selectMethod' ),\n        practice_chooser_name                 = document.getElementById( 'practice_chooser_name' ),\n        practice_chooser_stage                = document.getElementById( 'practice_chooser_stage' ),\n        practice_chooser_notation             = document.getElementById( 'practice_chooser_notation' ),\n        practice_chooser_ruleOffs             = document.getElementById( 'practice_chooser_ruleOffs' ),\n        practice_chooser_allowMethodSelection = document.getElementById( 'practice_chooser_allowMethodSelection' ),\n        practice_chooser_help                 = document.getElementById( 'practice_chooser_help' ),\n        searchResults                         = document.getElementById( 'searchResults' );\n\n\n    // If the setting to disable method choice is set, then hide the relevant UI elements\n    practice_chooser_allowMethodSelection.addEventListener( 'change', function() {\n        var allow = practice_chooser_allowMethodSelection.value === 'false'? false : true;\n        if( !allow ) { // No need to unhide as setting is only possible via query string and can't be turned off\n            var prevButton = document.querySelector( '#chooseOptions .prev_button' );\n            prevButton.style.pointerEvents = 'none';\n            prevButton.style.opacity = 0;\n            document.querySelector( '#chooseOptions h3' ).style.display = 'none';\n            document.querySelector( '#head h1' ).innerHTML = (practice_chooser_name.value !== '')? '<span style=\"font-weight:normal\">Method Tutor &raquo;</span> '+practice_chooser_name.value : 'Method Tutor';\n        }\n    } );\n\n\n    // Listen for changes to the name box and initiate a search\n    var searchCount = 0,\n        activeSearchCount = -1;\n    practice_chooser_name.addEventListener( 'input', function( e ) {\n        // Hide the search results if the value is empty\n        if( e.target.value === '' ) {\n            searchResults.style.display = 'none';\n            return;\n        }\n        // Otherwise search, and update the results <ul> with the methods\n        var thisSearchCount = searchCount;\n        searchCount++;\n        fetch( 'https://rsw.me.uk/blueline/methods/search.json?q=' + encodeURIComponent( e.target.value ) )\n            .then( function( r ) {\n                if( thisSearchCount < activeSearchCount ) {\n                    throw new Error( 'Ignored result received out of sync' );\n                }\n                else {\n                    activeSearchCount = thisSearchCount;\n                    return r.json();\n                }\n            } )\n            .then( function( data ) {\n                var fragment = '';\n                for( var i = 0; i < 4; i++ ) {\n                    if( typeof data.results[i] === 'undefined' ) { break; }\n                    fragment += '<li class=\"result\" data-stage=\"'+data.results[i].stage+'\" data-notation=\"'+data.results[i].notation+'\" data-ruleOffs=\"{&quot;from&quot;:'+data.results[i].ruleOffs.from+',&quot;every&quot;:'+data.results[i].ruleOffs.every+'}\">'+data.results[i].title+'</li>';\n                }\n                fragment += '<li class=\"close\">Close Search Results ✖</li>';\n                searchResults.innerHTML = fragment;\n                searchResults.style.marginBottom = (i*-33)+'px';\n                searchResults.style.display = 'block';\n            } )\n            .catch( function( e ) {\n                console.log( e );\n            } );\n\n    } );\n\n\n    // Listen for changes to place notation and only let user proceed if it's populated\n    var nextButton = document.querySelector( '#selectMethod .next_button' ),\n        pnChange =  function( e ) {\n        if( practice_chooser_notation.value === '' ) {\n            nextButton.style.pointerEvents = 'none';\n            nextButton.style.opacity = 0;\n        }\n        else {\n            nextButton.style.pointerEvents = 'auto';\n            nextButton.style.opacity = 1;\n        }\n    };\n    practice_chooser_notation.addEventListener( 'change', pnChange );\n    practice_chooser_notation.addEventListener( 'input', pnChange );\n\n\n    // Listen for changes to title. Show the restart button, and make the help bolder\n    var prevButton = document.querySelector( '#selectMethod .prev_button' ),\n        titleChange =  function( e ) {\n        if( practice_chooser_name.value === '' ) {\n            prevButton.style.pointerEvents = 'none';\n            prevButton.style.opacity = 0;\n            practice_chooser_help.classList.add( 'pulse' );\n        }\n        else {\n            prevButton.style.pointerEvents = 'auto';\n            prevButton.style.opacity = 1;\n            practice_chooser_help.classList.remove( 'pulse' );\n        }\n    };\n    practice_chooser_name.addEventListener( 'change', titleChange );\n    practice_chooser_name.addEventListener( 'input', titleChange );\n\n\n    // Reset the form and focus the search box when the restart button is clicked\n    document.querySelector( '#selectMethod input[type=\"reset\"]' ).addEventListener( 'click', function(e) {\n        practice_chooser_name.value = '';\n        practice_chooser_notation.value = '';\n        practice_chooser_stage.value = '';\n        practice_chooser_ruleOffs.value = '';\n        practice_chooser_name.dispatchEvent( new Event( 'change', { bubbles: true } ) );\n        practice_chooser_notation.dispatchEvent( new Event( 'change', { bubbles: true } ) );\n        practice_chooser_stage.dispatchEvent( new Event( 'change', { bubbles: true } ) );\n        practice_chooser_ruleOffs.dispatchEvent( new Event( 'change', { bubbles: true } ) );\n        practice_chooser_name.focus();\n    } )\n\n\n    // Listen for clicks on search results\n    $document_on( 'click', '#searchResults li.result', function( e ) {\n        practice_chooser_name.value = e.target.innerText;\n        practice_chooser_notation.value = e.target.dataset.notation;\n        practice_chooser_stage.value = e.target.dataset.stage;\n        practice_chooser_ruleOffs.value = e.target.dataset.ruleoffs;\n        practice_chooser_name.dispatchEvent( new Event( 'change', { bubbles: true } ) );\n        practice_chooser_notation.dispatchEvent( new Event( 'change', { bubbles: true } ) );\n        practice_chooser_stage.dispatchEvent( new Event( 'change', { bubbles: true } ) );\n        practice_chooser_ruleOffs.dispatchEvent( new Event( 'change', { bubbles: true } ) );\n        searchResults.style.display = 'none';\n    } );\n    $document_on( 'click', '#searchResults li.close', function( e ) {\n        searchResults.style.display = 'none';\n    } );\n\n\n    // Focus the search box when '/' is typed\n    document.body.addEventListener( 'keydown', function( e ) {\n        if( practice_chooser_container.classList.contains( 'active' ) && e.key == '/' && document.activeElement.id !== 'practice_chooser_name' ) {\n            practice_chooser_name.focus();\n            e.preventDefault();\n        }\n    } );\n\n\n    // Tag the active search result\n    $document_on( 'mouseover', '#searchResults li.result', function( e ) {\n        var searchResults_li = e.target.parentElement.children;\n        for( var i = 0; i < searchResults_li.length; i++ ) {\n            searchResults_li[i].classList.remove( 'active' );\n        }\n        e.target.classList.add( 'active' );\n    } );\n    $document_on( 'mouseout', '#searchResults li.result', function( e ) {\n        e.target.classList.remove( 'active' );\n    } );\n\n\n    // Allow keyboard interaction with search results\n    document.body.addEventListener( 'keydown', function( e ) {\n        if( searchResults.style.display === 'block' ) {\n            if( e.key === 'Escape' ) {\n                document.querySelector( '#searchResults li.close' ).dispatchEvent( new Event( 'click', { bubbles: true } ) );\n                e.preventDefault();\n                return;\n            }\n            if( e.key === 'Enter' ) {\n                var active_searchResults_li = document.querySelector( '#searchResults li.active' );\n                if( active_searchResults_li !== null ) {\n                    active_searchResults_li.dispatchEvent( new Event( 'click', { bubbles: true } ) );\n                    e.preventDefault();\n                }\n                return;\n            }\n            if( e.key === 'ArrowUp' || e.key === 'ArrowDown' ) {\n                // Find the target\n                var active_searchResults_li = document.querySelector( '#searchResults li.active' ),\n                    target_searchResults_li;\n                if( active_searchResults_li !== null && e.key === 'ArrowUp' ) {\n                    target_searchResults_li = active_searchResults_li.previousSibling;\n                }\n                if( active_searchResults_li === null && e.key === 'ArrowDown' ) {\n                    target_searchResults_li = document.querySelector( '#searchResults li' );\n                }\n                if( active_searchResults_li !== null && e.key === 'ArrowDown' ) {\n                    target_searchResults_li = active_searchResults_li.nextSibling;\n                    if( target_searchResults_li === null ) {\n                        target_searchResults_li = document.querySelector( '#searchResults li' );\n                    }\n                }\n                // Switch to it\n                if( active_searchResults_li !== null ) {\n                    active_searchResults_li.dispatchEvent( new Event( 'mouseout', { bubbles: true } ) );\n                }\n                if( target_searchResults_li !== null ) {\n                    target_searchResults_li.dispatchEvent( new Event( 'mouseover', { bubbles: true } ) );\n                }\n                e.preventDefault();\n                return;\n            }\n        }\n    } );\n});\n","// Parse and handle place notation for change ringing\nvar PlaceNotation = {\n\tbellToCharMap: ['1','2','3','4','5','6','7','8','9','0','E','T','A','B','C','D','F','G','H','J','K','L','M','N','P','Q','R','S','U','V','W','Y','Z'],\n\tbellToChar: function( bell ) {\n\t\treturn PlaceNotation.bellToCharMap[parseInt( bell, 10 )];\n\t},\n\tcharToBell: function( ch ) {\n\t\tvar bell = parseInt( ch, 10 );\n\t\tif( isNaN( bell ) || bell === 0 ) {\n\t\t\tbell = PlaceNotation.bellToCharMap.indexOf( ch );\n\t\t\tif( bell === -1 ) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t--bell;\n\t\t}\n\t\treturn bell;\n\t},\n\texpand: function( notation, stage ) {\n\t\t// Tries to normalise place notation given in abbreviated form into full notation\n\t\tvar fullNotation, matches, stageText;\n\n\t\tfullNotation = notation\n\t\t\t.toUpperCase().replace( /X/g, 'x' ) // Tidy up cases\n\t\t\t.replace( /[{<].*[}>]/, '' ).replace( / FCH.*$/, '' ) // Remove anything inside (non normal) brackets, or appended fch details\n\t\t\t.replace( /\\.?x\\.?/g, 'x' ) // Remove weird input that might mess things up later\n\t\t\t.trim();\n\n\t\t// If stage isn't given try to guess\n\t\tif( typeof stage === 'undefined' ) {\n\t\t\tstage = Math.max.apply( Math, notation.replace( /( HL |LH|LE)/g , '' ).split( '' ).map( PlaceNotation.charToBell ).filter( function(b) { return typeof b === 'number'; } ) ) + 1;\n\t\t}\n\t\tstageText = PlaceNotation.bellToChar( stage-1 );\n\n\t\t// Deal with notation like 'x1x1x1-2' (After checking for this form we can assume - means x)\n\t\tmatches = fullNotation.match( /^([^-]+)-([^-\\.,x]+)$/ );\n\t\tif( matches !== null ) {\n\t\t\tfullNotation = PlaceNotation.expandHalf( matches[1] ) + matches[2];\n\t\t}\n\t\tfullNotation = fullNotation.replace( /-/g, 'x' );\n\n\t\t// Turn notation like \"...x34 hl 16 le 12\" into \"...x34.16 le 12\"\n\t\tif( fullNotation.indexOf( ' HL ' ) !== -1 ) {\n\t\t\tfullNotation = fullNotation.replace( ' HL ', '.' );\n\t\t}\n\n\t\t// Deal with notation like '-1-1-1LH2', or '-1-1-1 le2'. Allow a preceding ampersand\n\t\tmatches = fullNotation.match( /^&?(.*)(LH|LE)/ );\n\t\tif( matches !== null ) {\n\t\t\tfullNotation = fullNotation.replace( matches[0], PlaceNotation.expandHalf( matches[1] ) );\n\t\t}\n\n\t\t// Parse microSiril format notation\n\t\tif( fullNotation.indexOf( ',' ) !== -1 ) {\n\t\t\tvar splitOnComma = fullNotation.split( ',' ).map( function( s ) { return s.trim(); } );\n\t\t\tif( splitOnComma.reduce( function( prev, cur ) { // If every block starts with either an & or a +\n\t\t\t\treturn prev && ( cur.charAt(0) == '&' || cur.charAt(0) == '+' );\n\t\t\t}, true ) ) {\n\t\t\t\tfullNotation = splitOnComma.reduce( function( prev, cur ) { // Expand the symmetrical blocks, keep the asymmetrical ones as they are but remove the +\n\t\t\t\t\treturn prev + '.' + ((cur.charAt(0) == '&')?  PlaceNotation.expandHalf( cur ) : cur.replace( '+', '' ));\n\t\t\t\t}, '' );\n\t\t\t}\n\t\t}\n\n\t\t// Now we've checked for proper microSiril format we'll make some assumptions about what people might actually mean.\n\t\t// Deal with notation like '-1-1-1,2' or '3,1.5.1.5.1'.\n\t\tmatches = fullNotation.match( /^\\s*&?\\s*(.*),(.*)/ );\n\t\tif( matches !== null ) {\n\t\t\tfullNotation = (PlaceNotation.expandHalf( matches[1] )+'.'+PlaceNotation.expandHalf( matches[2] )).replace( /\\.?x\\.?/g, 'x' );\n\t\t}\n\n\t\t// Get rid of +\n\t\tfullNotation = fullNotation.replace( /\\+/g, ' ' );\n\n\t\t// Convert 'a &-1-1-1' type notation into '&x1x1x1 2' type\n\t\t// regular lead heads\n\t\tmatches = fullNotation.match( /^([A-S]{1}[1-9]?)\\s+(.*)$/ );\n\t\tif( matches !== null ) {\n\t\t\tif( stage % 2 === 0 ) {\n\t\t\t\t// a to f is 12\n\t\t\t\tif( /^[A-F]{1}/.test( matches[1] ) ) {\n\t\t\t\t\tfullNotation = matches[2]+' 12';\n\t\t\t\t}\n\t\t\t\t// g to m is 1n\n\t\t\t\telse if( /^[G-M]{1}/.test( matches[1] ) ) {\n\t\t\t\t\tfullNotation = matches[2]+' 1'+stageText;\n\t\t\t\t}\n\t\t\t\t// p, q is 3n post lead head (if 3n isn't the start of $match[2] then add it to the start)\n\t\t\t\telse if( /^[P-Q]{1}/.test( matches[1] ) ) {\n\t\t\t\t\tif( matches[2].indexOf( '3' ) === 0 ) {\n\t\t\t\t\t\tfullNotation = matches[2];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfullNotation = '3' + stageText + ' ' + matches[2];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// r, s is n post lead head\n\t\t\t\t// I don't know why I think this... but it doesn't seem to be true looking at actual methods in the current collections.\n\t\t\t\t// Let me know if you know!\n\t\t\t\t//else {\n\t\t\t\t//\tif( matches[2].indexOf( 'x' ) === 0 ) {\n\t\t\t\t//\t\tfullNotation = matches[2];\n\t\t\t\t//\t}\n\t\t\t\t//\telse {\n\t\t\t\t//\t\tfullNotation = 'x' + matches[2];\n\t\t\t\t//\t}\n\t\t\t\t//}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// a to f is 3 post lead head (if 3 isn't the start of $match[2] then add it to the start)\n\t\t\t\tif( /^[A-F]{1}/.test( matches[1] ) ) {\n\t\t\t\t\tif( matches[2].indexOf( '3' ) === 0 ) {\n\t\t\t\t\t\tfullNotation = matches[2];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfullNotation = '3 ' + matches[2];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// g to m is n post lead head\n\t\t\t\telse if( /^[G-M]{1}/.test( matches[1] ) ) {\n\t\t\t\t\tif( matches[2].indexOf( stageText ) === 0 ) {\n\t\t\t\t\t\tfullNotation = matches[2];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfullNotation = stageText + ' ' + matches[2];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// p, q is 12n\n\t\t\t\telse if( /^[P-Q]{1}/.test( matches[1] ) ) {\n\t\t\t\t\tfullNotation = matches[2]+' 12'+stageText;\n\t\t\t\t}\n\t\t\t\t// r, s is 1\n\t\t\t\telse {\n\t\t\t\t\tfullNotation = matches[2]+' 1';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// z is an irregular lead head\n\t\tmatches = fullNotation.match( /^(.*)Z\\s+(.*)$/ );\n\t\tif( matches !== null ) {\n\t\t\tfullNotation = matches[2] + ' ' + matches[1];\n\t\t}\n\n\t\t// Deal with, '&x1x1x1 2' type notation\n\t\tmatches = fullNotation.match( /^&(.*)\\s+([^x.]+)$/ );\n\t\tif( matches !== null ) {\n\t\t\tfullNotation = PlaceNotation.expandHalf( matches[1] )+' '+matches[2];\n\t\t}\n\n\t\t// Some last bits of cleaning up\n\t\tfullNotation = fullNotation\n\t\t\t.replace( /\\s+/g, '.' )       // Replace any remaining whitespace with dots\n\t\t\t.replace( /(^\\.+|\\.+$)/g, '') // Remove trailing or preceding dots\n\t\t\t.replace( /\\.+/g, '.' )       // Remove any unnecessary doubling up of dots\n\t\t\t.replace( /\\.?x\\.?/g, 'x' );  // and any .x.\n\n\t\t// Explode the notation so we can work on each piece individually, then join back together\n\t\tfullNotation = PlaceNotation.explode( fullNotation ).map( function( piece ) {\n\t\t\t// Tidy up 'x' on odd stages\n\t\t\tif( piece === 'x' ) {\n\t\t\t\treturn (stage % 2 === 0)? 'x' : stageText;\n\t\t\t}\n\t\t\t// Check for empty\n\t\t\tif( piece.match( /[A-Z\\d]+/g ) === null ) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\t// Work out which places are affected\n\t\t\tvar affected = piece.match( /[A-Z\\d]+/g ).join( '' ).split( '' ).map( PlaceNotation.charToBell ).sort( function( a, b ) { return a - b;} );\n\t\t\t// Then add missing external places\n\t\t\t// If the first bell is even, prepend a 1\n\t\t\tif( (affected[0]+1) % 2 === 0 ) {\n\t\t\t\tpiece = '1'+piece;\n\t\t\t}\n\t\t\t// If stage odd and last bell even, or stage even and last bell odd, append an n\n\t\t\tif( (stage % 2 === 0) ? ((affected[affected.length-1]+1) % 2 !== 0) : ((affected[affected.length-1]+1) % 2 === 0) ) {\n\t\t\t\tpiece = piece + stageText;\n\t\t\t}\n\t\t\t// Sort the piece characters numerically\n\t\t\t// Since we don't want to sort inside '()' or '[]' (for jump changes), map those from '[abc]' to max(a, b, c) for sorting purposes (keeping\n\t\t\t// both the original value and the 'sort key').\n\t\t\t// This is a bit messy because we need to split twice, once from 12(35)6 to ['12', '(35)' '6'],\n\t\t\t// then again to [['1','2'], '(35)', ['6']], then flatten the array before sorting and joining back to a string.\n\t\t\t// There's probably a clearer way to do this.\n\t\t\tpiece = [].concat.apply( [],\n\t\t\t\tpiece.replace( /\\(/g, '~(' ).replace( /\\)/g, ')~' ).replace( /\\[/g, '~[' ).replace( /\\]/g, ']~' ).split('~')\n\t\t\t\t\t.filter( function( e ) { return e !== ''; } )\n\t\t\t\t\t.map( function( e ) {\n\t\t\t\t\t\tif( e.charAt( 0 ) == '(' || e.charAt( 0 ) == '[' ) {\n\t\t\t\t\t\t\treturn { sort: Math.max.apply( Math, e.split( '' ).map( PlaceNotation.charToBell ) ), value: e };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\treturn e.split( '' ).map( function( f ) { return { sort: PlaceNotation.charToBell( f ), value: f }; } );\n\t\t\t\t\t\t}\n\t\t\t\t\t} ) )\n\t\t\t\t.sort( function( a, b ) {\n\t\t\t\t\treturn a.sort - b.sort;\n\t\t\t\t} )\n\t\t\t\t.map( function( e ) {\n\t\t\t\t\treturn e.value;\n\t\t\t\t} )\n\t\t\t\t.join( '' );\n\t\t\treturn piece;\n\t\t} ).join( '.' ).replace( /\\.?x\\.?/g, 'x' );\n\n\t\treturn fullNotation;\n\t},\n\texpandHalf: function( notation ) {\n\t\t// Expands a symmetrical block of place notation\n\t\tnotation = notation.replace( /^&/, '' );\n\t\tvar notationReversed = notation.split( '' ).reverse().join( '' )\n\t\t\t\t.replace( /\\)(.+?)\\(/g, function( m, p1 ) { return '('+p1+')'; } )\n\t\t\t\t.replace( /\\](.+?)\\[/g, function( m, p1 ) { return '['+p1.split( '' ).reverse().join( '' )+']'; } ),\n\t\t\tfirstDot = (notationReversed.indexOf( '.' ) === -1)? 9999 : notationReversed.indexOf( '.' ),\n\t\t\tfirstX = (notationReversed.indexOf( 'x' ) === -1)? 9999 : notationReversed.indexOf( 'x' ),\n\t\t\ttrim;\n\t\tif( firstDot < 0 && firstX < 0 ) {\n\t\t\treturn notation;\n\t\t}\n\t\telse if( firstDot < 0 || firstX < firstDot ) {\n\t\t\ttrim = (firstX === 0) ? 1 : firstX;\n\t\t}\n\t\telse {\n\t\t\ttrim = firstDot;\n\t\t}\n\t\treturn (notation + notationReversed.substring( trim )).replace( /\\.?(x|-)\\.?/g, 'x' ).trim();\n\t},\n\tparse: function( notation, stage ) {\n\t\t// Parses normalised place notation into permutations\n\t\tvar i, j, k, l,\n\t\t\tparsed = [],\n\t\t\texploded = this.explode( notation ),\n\t\t\txPermutation = new Array( stage );\n\n\t\t// Construct the X permutation for stage\n\t\tfor( i = 0; i < stage; i+=2 ) { xPermutation[i] = i+1; xPermutation[i+1] = i; }\n\t\tif( i-1 === stage ) { xPermutation[i-1] = i-1; }\n\n\t\t// Then parse section by section\n\t\tfor( i = 0; i < exploded.length; i++ ) {\n\t\t\t// For an x, push our pre-generated x permutation\n\t\t\tif( exploded[i] === 'x' ) {\n\t\t\t\tparsed.push( xPermutation );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar permutation = new Array( stage ),\n\t\t\t\t\tnotationCharacters = exploded[i].split( '' );\n\t\t\t\tfor( j = 0; j < notationCharacters.length; j++ ) {\n\t\t\t\t\t// A jump change (XY) sends the bell in the 1st place to the 2nd, and the bells in the span shift\n\t\t\t\t\t// (13) takes 1234 to 2314,\n\t\t\t\t\t// (14) takes 1234 to 2341,\n\t\t\t\t\t// (31) takes 1234 to 3124,\n\t\t\t\t\t// (41) takes 1234 to 4123 and so on\n\t\t\t\t\tif( notationCharacters[j] === '(' ) {\n\t\t\t\t\t\tvar from = this.charToBell( notationCharacters[j+1] ),\n\t\t\t\t\t\t\tto   = this.charToBell( notationCharacters[j+2] );\n\t\t\t\t\t\tpermutation[to] = from;\n\t\t\t\t\t\tif( from < to ) {\n\t\t\t\t\t\t\tfor( k = from; k < to; k++ ) {\n\t\t\t\t\t\t\t\tpermutation[k] = k+1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tfor( k = from; k > to; k-- ) {\n\t\t\t\t\t\t\t\tpermutation[k] = k-1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tj += 3;\n\t\t\t\t\t}\n\t\t\t\t\t// A jump change [ABCD] describes what happens to position between min(A,B,C,D) and max(A,B,C,D)\n\t\t\t\t\t// [4321] takes 1234 to 4321 and so on\n\t\t\t\t\telse if( notationCharacters[j] === '[' ) {\n\t\t\t\t\t\t++j;\n\t\t\t\t\t\tk = notationCharacters.indexOf( ']', j );\n\t\t\t\t\t\tl = 0;\n\t\t\t\t\t\tvar lowestBell = Math.min.apply( Math, notationCharacters.slice( j, k ).map( this.charToBell ) );\n\t\t\t\t\t\twhile( j < k ) {\n\t\t\t\t\t\t\tpermutation[lowestBell+l] = this.charToBell( notationCharacters[j] );\n\t\t\t\t\t\t\t++j;\n\t\t\t\t\t\t\t++l;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar stationary = this.charToBell( notationCharacters[j] );\n\t\t\t\t\t\tpermutation[stationary] = stationary;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Then 'x' what's left\n\t\t\t\tfor( j = 0; j < stage; j++ ) {\n\t\t\t\t\tif( typeof( permutation[j] ) === 'undefined' ) {\n\t\t\t\t\t\tif( typeof( permutation[j+1] ) === 'undefined' && j+1 < stage ) {\n\t\t\t\t\t\t\tpermutation[j] = j+1;\n\t\t\t\t\t\t\tpermutation[j+1] = j;\n\t\t\t\t\t\t\tj++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tpermutation[j] = j;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tparsed.push( permutation );\n\t\t\t}\n\t\t}\n\t\treturn parsed;\n\t},\n\timplode: function( notationArray ) {\n\t\treturn ( typeof notationArray.join === 'function' )? notationArray.join( '.' ).replace( /\\.?x\\.?/g, 'x' ) : notationArray;\n\t},\n\texplode: function( notation ) {\n\t\treturn (typeof notation === 'string')? notation.replace( /x/gi, '.x.' ).split( '.' ).filter( function( e ) { return e !== ''; } ) : notation;\n\t},\n\trounds: function( stage ) {\n\t\tvar row = new Array( stage ), i = stage;\n\t\twhile( i-- ) { row[i] = i; }\n\t\treturn row;\n\t},\n\tbackRounds: function( stage ) {\n\t\treturn PlaceNotation.rounds( stage ).reverse();\n\t},\n\tqueens: function( stage ) {\n\t\tif( stage < 4 )  { throw new Error(\"Stage must be >= 4 for Queens notation.\"); }\n\t\tif( stage % 2 === 1 ) { return PlaceNotation.queens( stage + 1 ).slice( 1 ).map( function( e ) { return --e; } ); }\n\t\tvar row = new Array( stage ), i = stage, mid = Math.ceil( stage / 2 );\n\t\twhile( i-- > mid ) { row[i] = 1 + (i-mid)*2; }\n\t\tdo { row[i] = i*2; } while( i-- );\n\t\treturn row;\n\t},\n\tkings: function( stage ) {\n\t\tvar mid = Math.floor( stage / 2 ),\n\t\t\tqueens = PlaceNotation.queens( stage );\n\t\treturn queens.slice( 0, mid ).reverse().concat( queens.slice( mid ) );\n\t},\n\ttittums: function( stage ) {\n\t\tif( stage % 2 === 1 ) { return PlaceNotation.tittums( stage + 1 ).slice( 1 ).map( function( e ) { return --e; } ); }\n\t\tvar row = new Array( stage ), i = stage, mid = Math.floor( stage / 2 );\n\t\twhile( i-- ) { row[i] = Math.ceil( i / 2) + ((i%2 === 0)? 0 : mid); }\n\t\treturn row;\n\t},\n\twhittingtons: function( stage ) {\n\t\tif( stage < 6 )  { throw new Error(\"Stage must be >= 6 for Whittingtons notation.\"); }\n\t\tif( stage % 2 === 1 ) { return PlaceNotation.whittingtons( stage + 1 ).slice( 1 ).map( function( e ) { return --e; } ); }\n\t\tvar row = new Array( stage ), i = stage, mid = Math.floor( stage / 2 );\n\t\twhile( i-- > stage - 3 ) { row[i] = 1 + (i-mid)*2; }\n\t\trow[i] = row[i+1]-1;\n\t\trow[--i] = row[i+1]+2;\n\t\tif( i ) { row[--i] = row[i+1]+2 };\n\t\twhile( i-- ) { row[i] = i; }\n\t\treturn row;\n\t},\n\trowsEqual: function( row1, row2 ) {\n\t\tvar i = row1.length;\n\t\tif( i !== row2.length) {\n\t\t\treturn false;\n\t\t}\n\t\twhile( i-- ) {\n\t\t\tif( row1[i] !== row2[i] ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t},\n\tallRows: function( notation, startRow ) {\n\t\tvar rows = [startRow],\n\t\t\ti = 0, iLim = notation.length;\n\t\twhile( i < iLim ) {\n\t\t\trows.push( this.apply( notation[i], rows[i] ) );\n\t\t\t++i;\n\t\t}\n\t\treturn rows;\n\t},\n\tapply: function( permutation, row ) {\n\t\tvar permuted;\n\t\tif( typeof permutation[0].forEach === 'function' ) {\n\t\t\tpermuted = row;\n\t\t\tpermutation.forEach( function( p ) { permuted = this.apply( p, permuted ); }, this );\n\t\t\treturn permuted;\n\t\t}\n\t\tvar i = permutation.length,\n\t\t\tj = row.length;\n\t\tpermuted = new Array( j );\n\t\twhile( j-- > i ) {\n\t\t\tpermuted[j] = row[j];\n\t\t}\n\t\tdo {\n\t\t\tpermuted[j] = row[permutation[j]];\n\t\t} while( j-- );\n\t\treturn permuted;\n\t},\n\tcycles: function( permutation ) {\n\t\tvar cycles = [],\n\t\t\ti = permutation.length,\n\t\t\trounds = this.rounds( i ),\n\t\t\tcycle, calcRow;\n\t\twhile( i-- ) {\n\t\t\tif( rounds[i] === -1 ) { continue; }\n\t\t\tcycle = [rounds[i]];\n\t\t\tfor( calcRow = permutation; calcRow[i] !== rounds[i]; calcRow = this.apply( permutation, calcRow ) ) {\n\t\t\t\tcycle.push( calcRow[i] );\n\t\t\t\trounds[calcRow[i]] = -1;\n\t\t\t}\n\t\t\trounds[i] = -1;\n\t\t\tcycles.push( cycle );\n\t\t}\n\t\treturn cycles;\n\t},\n\thuntBells: function( notation, stage ) {\n\t\tvar start = this.rounds( stage ),\n\t\t\tend = this.apply( notation, start ),\n\t\t\thunts = [];\n\t\tfor( var i = 0; i < stage; ++i ) {\n\t\t\tif( start[i] === end[i] ) { hunts.push( i ); }\n\t\t}\n\t\treturn hunts;\n\t}\n};\n\nexport default PlaceNotation;\n","/**\n * Manages creation of canvas elements to cope with different pixel ratios\n */\n// AMD define wrapper removed; using ES module\nvar Canvas = function( options ) {\n\t// Create canvas element\n\tvar queryString = location.href.replace( /^.*?(\\?|$)/, '' ),\n\t\tpixelRatio  = (typeof options.scale === 'number')? options.scale : (\n\t\t\t\t\t\t(queryString.indexOf( 'scale=' ) !== -1)? parseInt( queryString.replace( /^.*scale=(.*?)(&.*$|$)/, '$1' ) ) :\n\t\t\t\t\t\t( (typeof window.devicePixelRatio === 'number')? window.devicePixelRatio : 1) ),\n\t\tcanvas      = document.createElement( 'canvas' );\n\tcanvas.setAttribute( 'id', options.id );\n\tcanvas.setAttribute( 'width', options.width * pixelRatio );\n\tcanvas.setAttribute( 'height', options.height * pixelRatio );\n\tcanvas.style.width = options.width+'px';\n\tcanvas.style.height = options.height+'px';\n\n\t// Move variables onto object\n\tthis.width = options.width;\n\tthis.height = options.height;\n\tthis.element = canvas;\n\tthis.context = canvas.getContext( '2d' );\n\tthis.scale = pixelRatio;\n\n\t// Scale for high pixel ratios\n\tif( pixelRatio !== 1 ) {\n\t\tthis.context.scale( pixelRatio, pixelRatio );\n\t}\n\n\t// Add placeholder functions for browsers that lack support\n\tif (!this.context.setLineDash) {\n\t\tthis.context.setLineDash = function () {};\n\t}\n\tif (!this.context.fillText) {\n\t\tthis.context.fillText = function () {};\n\t}\n\n\treturn this;\n};\nCanvas.prototype = {\n\ttype: 'canvas'\n};\n\nexport default Canvas;\n","// ES module: local storage cache and settings\nvar prefix = 'mt_';\nvar dataAge = document.getElementsByTagName('html')[0].getAttribute('data-age');\nvar LocalStorage = {\n\tage: parseInt( dataAge )\n};\nLocalStorage.getItem = function( key ) {\n\treturn JSON.parse( localStorage.getItem( prefix+key ) );\n};\nLocalStorage.setItem = function( key, value ) {\n\tlocalStorage.setItem( prefix+key, JSON.stringify(value) );\n};\nLocalStorage.removeItem = function( key ) {\n\tlocalStorage.removeItem( prefix+key );\n};\nLocalStorage.clear = function() {\n\tlocalStorage.clear();\n};\nLocalStorage.getCache = function( key ) {\n\treturn LocalStorage.getItem( 'cache_'+key );\n};\nLocalStorage.setCache = function( key, value ) {\n\tLocalStorage.setItem( 'cache_'+key, value );\n};\nLocalStorage.removeCache = function( key ) {\n\tLocalStorage.removeItem( 'cache_'+key );\n};\nvar cacheKey = new RegExp( '(^'+prefix+'cache_.*|^'+prefix+'Offset.*|^'+prefix+'Width.*)' );\nLocalStorage.clearCache = function() {\n\tvar key, keys = [];\n\tfor( var i = 0; i < localStorage.length; ++i ) {\n\t\tkey = localStorage.key( i );\n\t\tif( key.match( cacheKey ) !== null ) {\n\t\t\tkeys.push( key );\n\t\t}\n\t}\n\tkeys.forEach( function( key ) {\n\t\tlocalStorage.removeItem( key );\n\t} );\n};\nLocalStorage.getSetting = function( key, defaultSetting ) {\n\tvar value = LocalStorage.getItem( 'setting_'+key );\n\treturn (value === null)? defaultSetting : value;\n};\nLocalStorage.setSetting = function( key, value ) {\n\tLocalStorage.setItem( 'setting_'+key, value );\n};\nLocalStorage.removeSetting = function( key ) {\n\tLocalStorage.removeItem( 'setting_'+key );\n};\nvar settingsKey = new RegExp( '^'+prefix+'setting_.*' );\nLocalStorage.clearSettings = function() {\n\tvar key, keys = [];\n\tfor( var i = 0; i < localStorage.length; ++i ) {\n\t\tkey = localStorage.key( i );\n\t\tif( key.match( settingsKey ) !== null ) {\n\t\t\tkeys.push( key );\n\t\t}\n\t}\n\tkeys.forEach( function( key ) {\n\t\tlocalStorage.removeItem( key );\n\t} );\n};\n\n// Clear out the cache if the app's age has changed\nvar cacheAge = LocalStorage.getItem( 'cacheAge' );\nif( cacheAge === null ) { cacheAge = 0; }\nif( cacheAge < LocalStorage.age ) {\n\tLocalStorage.clearCache();\n\tLocalStorage.setItem( 'cacheAge', LocalStorage.age );\n}\nexport default LocalStorage;\n","import Canvas from './Canvas.js';\nimport LocalStorage from './LocalStorage.js';\n\n// Measure X and Y text padding for canvas text centering\n/*\n\t* Text positioning on a <canvas> is inconsistent across browsers and platforms.\n\t* This is a problem when trying to get pixel perfect alignments of text and lines.\n\t*\n\t* This function, given a font and size, will return the offset needed to be applied\n\t* to x and y to centre a single character of the font in a sizeXsize box when drawing\n\t* with textAlign=center and baseLine=middle\n\t* It caches the result\n*/\nvar measureXAndYTextPadding = function( size, font, text ) {\n\tif( typeof text == 'undefined' ) { text = '0'; }\n\tvar padding = LocalStorage.getCache( 'Offset.'+font+text );\n\tif( padding === null ) {\n\t\tvar canvas = new Canvas( {\n\t\t\tid: 'metric'+Math.floor((Math.random()*100)+1),\n\t\t\twidth: size*3,\n\t\t\theight: size*3,\n\t\t\tscale: (typeof window.devicePixelRatio === 'number')? Math.round(window.devicePixelRatio*8) : 8\n\t\t} );\n\t\tif( canvas !== false ) {\n\t\t\ttry {\n\t\t\t\tvar context = canvas.context;\n\t\t\t\tcontext.font = font;\n\t\t\t\tcontext.textAlign = 'center';\n\t\t\t\tcontext.textBaseline = 'middle';\n\t\t\t\tcontext.fillStyle = '#F00';\n\t\t\t\tcontext.fillText( text, size*1.5, size*1.5 );\n\n\t\t\t\tvar dim = size*3*canvas.scale,\n\t\t\t\t\timageData = context.getImageData( 0, 0, dim, dim ),\n\t\t\t\t\tbottomOfText = false,\n\t\t\t\t\ttopOfText = false,\n\t\t\t\t\tleftOfText = false,\n\t\t\t\t\trightOfText = false,\n\t\t\t\t\trow, column;\n\n\t\t\t\t// Find top\n\t\t\t\tfor( row = 0; topOfText === false && row < dim; ++row ) {\n\t\t\t\t\tfor( column = 0; column < dim ; ++column ) {\n\t\t\t\t\t\tif(imageData.data[((row*(dim*4)) + (column*4))] > 0 ) {\n\t\t\t\t\t\t\ttopOfText = row;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Find bottom\n\t\t\t\tfor( row = dim; bottomOfText === false && row > 0; --row ) {\n\t\t\t\t\tfor( column = 0; column < dim ; ++column ) {\n\t\t\t\t\t\tif( imageData.data[((row*(dim*4)) + (column*4))] > 0 ) {\n\t\t\t\t\t\t\tbottomOfText = row + 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Find left\n\t\t\t\tfor( column = 0; leftOfText === false && column < dim; ++column ) {\n\t\t\t\t\tfor( row = 0; row < dim ; ++row ) {\n\t\t\t\t\t\tif( imageData.data[((row*(dim*4)) + (column*4))] > 0 ) {\n\t\t\t\t\t\t\tleftOfText = column;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Find right\n\t\t\t\tfor( column = dim; rightOfText === false && column > 0; --column ) {\n\t\t\t\t\tfor( row = 0; row < dim ; ++row ) {\n\t\t\t\t\t\tif( imageData.data[((row*(dim*4)) + (column*4))] > 0 ) {\n\t\t\t\t\t\t\trightOfText = column + 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tpadding = {\n\t\t\t\t\tx: Math.round(1000*((dim - rightOfText) - leftOfText) / (canvas.scale*2))/1000,\n\t\t\t\t\ty: Math.round(1000*((dim - bottomOfText) - topOfText) / (canvas.scale*2))/1000\n\t\t\t\t};\n\n\t\t\t\tLocalStorage.setCache( 'Offset.'+font+text, padding );\n\t\t\t}\n\t\t\tcatch( e ) {\n\t\t\t\tpadding.x = padding.y = 0;\n\t\t\t}\n\t\t}\n\t\tcanvas = null;\n\t}\n\treturn padding;\n};\n\nexport default measureXAndYTextPadding;\n","import PlaceNotation from './PlaceNotation.js';\nimport Canvas from './Canvas.js';\nimport MeasureCanvasTextOffset from './MeasureCanvasTextOffset.js';\n\nvar RingingPractice = function( options ) {\n\t// Settings\n\tvar changeSpeed = 250;\n\n\t// Normalise method/interface options\n\tvar container = (typeof options.container === 'string')? document.getElementById( options.container ) : options.container,\n\t\tstage     = parseInt( options.stage ),\n\t\tnotation  = (typeof options.notation  === 'string')? PlaceNotation.parse( PlaceNotation.expand( options.notation, stage ), stage ) : options.notation,\n\t\tstartRow  = (typeof options.startRow  === 'string')? options.startRow.split( '' ).map( PlaceNotation.charToBell ) : ((typeof options.startRow === 'object')? options.startRow.slice(0) : PlaceNotation.rounds( stage )),\n\t\tfinishRow = ((typeof options.finishRow === 'string')? options.finishRow.split( '' ).map( PlaceNotation.charToBell ) :\n\t\t\t\t\t((typeof options.finishRow === 'object')? options.finishRow.slice(0) :\n\t\t\t\t\t((typeof options.finishRow === 'number'? Math.floor( options.finishRow ) :\n\t\t\t\t\tPlaceNotation.rounds( stage ) )))),\n\t\tfollowing = options.following;\n\tif( typeof options.score !== 'boolean' ) {\n\t\toptions.score = false;\n\t}\n\tif( typeof options.introduction !== 'boolean' ) {\n\t\toptions.introduction = false;\n\t}\n\tif( typeof options.autostart !== 'boolean' ) {\n\t\toptions.autostart = false;\n\t}\n\tif( Object.prototype.toString.call(options.buttons) !== '[object Array]' ) {\n\t\toptions.buttons = [];\n\t}\n\tif( typeof options.thatsAll !== 'boolean' && typeof options.thatsAll !== 'string' ) {\n\t\toptions.thatsAll = false;\n\t}\n\tif( typeof options.hbIndicator === 'boolean' ) {\n\t\toptions.hbIndicator = options.hbIndicator | 0;\n\t}\n\tif( options.hbIndicator !== 1 && options.hbIndicator !== -1 ) {\n\t\toptions.hbIndicator = 0;\n\t}\n\n\t// Sizing\n\tvar canvasWidth   = (typeof options.width == 'number')? options.width : container.offsetWidth,\n\t\tcanvasHeight  = ((typeof options.height == 'number')? options.height : container.offsetHeight) - 30,\n\t\tbellWidth     = Math.min( 20, (canvasWidth - 40) / stage ),\n\t\trowHeight     = bellWidth,\n\t\tpaddingForLeftMostPosition = (canvasWidth - ((stage-1)*bellWidth))/2;\n\n\t// Calling clearRect (to clear the canvas after each frame) is surprisingly resource intensive\n\t// so we only want to clear the part of the canvas we actually draw on. Calculate what that will be\n\tvar clearLeft  = Math.floor(Math.max(0, paddingForLeftMostPosition - (bellWidth/3))),\n\t\tclearWidth = Math.floor(Math.min((stage-1)*bellWidth + (2*bellWidth/3) + 4, canvasWidth - clearLeft));\n\n\t// Clear the container\n\tcontainer.innerHTML = '';\n\n\t// Create the canvas\n\tvar canvas = new Canvas( {\n\t\tid: 'practice_canvas',\n\t\twidth: canvasWidth,\n\t\theight: canvasHeight\n\t} );\n\tcontainer.appendChild( canvas.element );\n\n\t// Create the scoreboard\n\tvar scoreboard = (function() {\n\t\tvar scoreboard = document.createElement( 'div' );\n\t\tscoreboard.className = 'practice_scoreboard';\n\t\tcontainer.appendChild( scoreboard );\n\t\tvar rowCount   = 0,\n\t\t\terrorCount = 0;\n\t\treturn {\n\t\t\telement: scoreboard,\n\t\t\tshow: function() {\n\t\t\t\tif( options.score ) {\n\t\t\t\t\tscoreboard.className = 'practice_scoreboard visible';\n\t\t\t\t}\n\t\t\t},\n\t\t\thide: function() {\n\t\t\t\tscoreboard.className = 'practice_scoreboard';\n\t\t\t},\n\t\t\treset: function() {\n\t\t\t\trowCount = errorCount = 0;\n\t\t\t\tscoreboard.innerHTML  = 'Changes: '+rowCount+'<br/>Errors: '+errorCount;\n\t\t\t},\n\t\t\tscore: function() {\n\t\t\t\treturn Math.max(0,rowCount-errorCount)+'/'+rowCount+' ('+Math.max(0, Math.round(10*(100 - ((errorCount*100)/rowCount)))/10)+'%)';\n\t\t\t},\n\t\t\tcorrect: function() {\n\t\t\t\trowCount++;\n\t\t\t\tscoreboard.innerHTML = 'Changes: '+rowCount+'<br/>Errors: '+errorCount;\n\t\t\t},\n\t\t\terror: function() {\n\t\t\t\terrorCount++;\n\t\t\t\tscoreboard.innerHTML = 'Changes: '+rowCount+'<br/>Errors: '+errorCount;\n\t\t\t}\n\t\t};\n\t})();\n\n\t// Red error overlays in the background\n\tvar errorFlash = (function() {\n\t\tvar errorFlashes = {};\n\t\t['left', 'down', 'right'].forEach( function( e ) {\n\t\t\terrorFlashes[e] = document.createElement( 'div' );\n\t\t\terrorFlashes[e].className = 'practice_errorFlash_'+e;\n\t\t\tcontainer.appendChild( errorFlashes[e] );\n\t\t} );\n\n\t\treturn function( e ) {\n\t\t\terrorFlashes[e].className = 'practice_errorFlash_'+e;\n\t\t\tsetTimeout( function() { errorFlashes[e].className = 'error practice_errorFlash_'+e; }, 50 );  // Need the timeout so the browser ticks and the removal of the previous classes actually processes\n\t\t};\n\t})();\n\n\t// Pause button\n\tvar pauseButton = (function() {\n\t\tvar pause = document.createElement( 'div' );\n\t\tpause.className = 'practice_pause';\n\t\tcontainer.appendChild( pause );\n\t\tvar pauseFunction = function() {\n\t\t\tgoing = false;\n\t\t\tcanvasPaused = true;\n\t\t\tbuttons.show();\n\t\t\tpauseButton.hide();\n\t\t\tscoreboard.hide();\n\t\t\tcontrols.deactivate();\n\t\t};\n\t\tpause.addEventListener( 'click', pauseFunction );\n\t\tif( typeof document.hidden === 'boolean' ) {\n\t\t\tdocument.addEventListener( 'visibilitychange', function() {\n\t\t\t\tif( document.hidden === true && going ) {\n\t\t\t\t\tpauseFunction();\n\t\t\t\t}\n\t\t\t}, false );\n\t\t}\n\t\treturn {\n\t\t\telement: pause,\n\t\t\tshow: function() { pause.className = 'practice_pause visible'; },\n\t\t\thide: function() { pause.className = 'practice_pause'; }\n\t\t};\n\t})();\n\n\t// Other buttons\n\tvar buttons = (function() {\n\t\tvar buttonsContainer = document.createElement( 'div' );\n\t\tbuttonsContainer.className = 'practice_buttons visible';\n\t\tcontainer.appendChild( buttonsContainer );\n\n\t\tif( typeof options.title === 'string' && options.title !== '' ) {\n\t\t\tvar title = document.createElement( 'h1' );\n\t\t\ttitle.appendChild( document.createTextNode( options.title ) );\n\t\t\tbuttonsContainer.appendChild( title );\n\t\t}\n\t\telse {\n\t\t\tbuttonsContainer.style.height = '50px';\n\t\t}\n\n\t\tvar resumeCallback = function() {\n\t\t\tif( !going ) {\n\t\t\t\tgoing = true;\n\t\t\t\tcanvasPaused = false;\n\t\t\t\tbuttons.hide();\n\t\t\t\tpauseButton.show();\n\t\t\t\tcontrols.activate();\n\t\t\t\tscoreboard.show();\n\t\t\t\tcanvas.element.className = 'visible';\n\t\t\t\tdraw();\n\t\t\t}\n\t\t};\n\t\toptions.buttons.unshift( {\n\t\t\ttext: 'Start',\n\t\t\tcallback: function() {\n\t\t\t\tsetup();\n\t\t\t\tresumeCallback();\n\t\t\t}\n\t\t} );\n\t\toptions.buttons.unshift( {\n\t\t\ttext: 'Resume',\n\t\t\tcallback: resumeCallback\n\t\t} );\n\n\t\tvar buttonElements = options.buttons.map( function( e ) {\n\t\t\tvar button   = document.createElement( 'input' );\n\t\t\tbutton.value = e.text;\n\t\t\tbutton.type  = 'button';\n\t\t\tbutton.className = (typeof e.className === 'string')? e.className : '';\n\t\t\tbuttonsContainer.appendChild( button );\n\t\t\tbutton.addEventListener( 'click', e.callback );\n\t\t\treturn button;\n\t\t} );\n\n\t\treturn {\n\t\t\telement: buttonsContainer,\n\t\t\tshow: function() {\n\t\t\t\t// Treat the start and resume buttons specially\n\t\t\t\tif( currentRow > 0 ) {\n\t\t\t\t\tbuttonElements[1].value = 'Restart';\n\t\t\t\t\tbuttonElements[0].style.display = 'inline-block';\n\t\t\t\t}\n\t\t\t\tif( currentRow === 0 || finished ) {\n\t\t\t\t\tbuttonElements[0].style.display = 'none';\n\t\t\t\t}\n\t\t\t\tbuttonsContainer.className = 'practice_buttons visible';\n\t\t\t},\n\t\t\thide: function() {\n\t\t\t\tbuttonElements.forEach( function( e ) { e.blur(); } );\n\t\t\t\tbuttonsContainer.className = 'practice_buttons';\n\t\t\t}\n\t\t};\n\t})();\n\n\t// Controls\n\tvar controls = (function() {\n\t\tvar controlsContainer = document.createElement( 'div' );\n\t\tcontrolsContainer.className = 'practice_controls';\n\t\tcontainer.appendChild( controlsContainer );\n\t\treturn {\n\t\t\telement: controlsContainer,\n\t\t\tdeactivate: function() { controlsContainer.className = 'practice_controls'; },\n\t\t\tactivate: function()   { controlsContainer.className = 'practice_controls active'; }\n\t\t};\n\t})();\n\n\t// Function that flashes the buttons\n\tvar buttonFlash = (function() {\n\t\tvar control_button = {};\n\t\t['left', 'down', 'right'].forEach( function( e ) {\n\t\t\tcontrol_button[e] = document.createElement( 'div' );\n\t\t\tcontrol_button[e].className = 'practice_controls_'+e;\n\t\t\tcontrols.element.appendChild( control_button[e] );\n\t\t} );\n\n\t\treturn function( e, type ) {\n\t\t\tcontrol_button[e].className = 'practice_controls_'+e;\n\t\t\tsetTimeout( function() { control_button[e].className = type+' practice_controls_'+e; }, 50 ); // Need the timeout so the browser ticks and the removal of the previous classes actually processes\n\t\t};\n\t})();\n\n\n\t// Cache some reusable images to avoid excessive use of slow fillText calls in the drawing function that's meant to run at 60fps\n\tif( options.hbIndicator ) {\n\t\tvar fillTextCache_hbIndicator = function( char ) {\n\t\t\tvar cacheCanvas = new Canvas( {\n\t\t\t\tid: 'cc'+char,\n\t\t\t\twidth: 16,\n\t\t\t\theight: 16\n\t\t\t} );\n\t\t\tvar context = cacheCanvas.context;\n\t\t\tvar hMetrics = MeasureCanvasTextOffset( 16, '12px Roboto, sans-serif', char );\n\t\t\tcontext.fillStyle = '#999';\n\t\t\tcontext.textAlign = 'center';\n\t\t\tcontext.textBaseline = 'middle';\n\t\t\tcontext.font = '12px Roboto, sans-serif';\n\t\t\tcontext.fillText( char, 8 + hMetrics.x, 8 + hMetrics.y );\n\t\t\t// Check if the clearance rectangle needs to be increase\n\t\t\tif( paddingForLeftMostPosition-bellWidth-8 < clearLeft ) {\n\t\t\t\tclearWidth = Math.floor( clearWidth + clearLeft - (paddingForLeftMostPosition-bellWidth-8) );\n\t\t\t\tclearLeft = Math.floor( Math.max( 0, paddingForLeftMostPosition-bellWidth-8 ) );\n\t\t\t}\n\t\t\treturn cacheCanvas;\n\t\t};\n\t\tvar fillTextCache_hIndicator = fillTextCache_hbIndicator( 'H' );\n\t\tvar fillTextCache_bIndicator = fillTextCache_hbIndicator( 'B' );\n\t}\n\tif( typeof options.placeStarts === 'object' ) {\n\t\tvar fillTextCache_placeStarts = ( function() {\n\t\t\tvar x, y;\n\t\t\tvar cacheCanvas = new Canvas( {\n\t\t\t\tid: 'cc0',\n\t\t\t\twidth: 22*stage,\n\t\t\t\theight: 22\n\t\t\t} );\n\t\t\tvar context = cacheCanvas.context;\n\t\t\tvar placeStartTextMetrics = MeasureCanvasTextOffset( 16, '12px Roboto, sans-serif', '0' );\n\t\t\tcontext.strokeStyle = options.lines[following].color;\n\t\t\tcontext.fillStyle   = '#333';\n\t\t\tcontext.lineWidth   = 1.5;\n\t\t\tcontext.setLineDash( [] );\n\t\t\tcontext.font = '12px Roboto, sans-serif';\n\t\t\tcontext.textAlign = 'center';\n\t\t\tcontext.textBaseline = 'middle';\n\t\t\tfor( var i = 0; i < stage; ++i ) {\n\t\t\t\tx = (i+0.5)*22;\n\t\t\t\ty = 11;\n\t\t\t\tcontext.fillText( PlaceNotation.bellToChar( i ), x + placeStartTextMetrics.x, y + placeStartTextMetrics.y );\n\t\t\t\tcontext.beginPath();\n\t\t\t\tcontext.arc( x, y, 8, 0, Math.PI*2, true );\n\t\t\t\tcontext.closePath();\n\t\t\t\tcontext.stroke();\n\t\t\t}\n\t\t\t// Check if the clearance rectangle needs to be increase\n\t\t\tclearWidth = Math.floor( Math.max( clearWidth, paddingForLeftMostPosition + (stage*bellWidth) + 16 - clearLeft ) );\n\t\t\treturn cacheCanvas;\n\t\t})();\n\t}\n\tvar fillTextCache_guides = (function() {\n\t\tvar cacheCanvas = new Canvas( {\n\t\t\tid: 'cc1',\n\t\t\twidth: canvasWidth,\n\t\t\theight: 22\n\t\t} );\n\t\tvar context = cacheCanvas.context;\n\t\tcontext.fillStyle    = '#999';\n\t\tcontext.textAlign    = 'center';\n\t\tcontext.textBaseline = 'middle';\n\t\tcontext.font         = '12px Roboto, sans-serif';\n\t\tfor( var i = 0; i < stage; ++i ) {\n\t\t\tcontext.fillText( PlaceNotation.bellToChar( i ), paddingForLeftMostPosition + (i*bellWidth), 11 );\n\t\t}\n\t\treturn cacheCanvas;\n\t})();\n\tif( options.introduction ) {\n\t\tvar fillTextCache_introduction = (function() {\n\t\t\t// Create the canvas and set global options\n\t\t\tvar cacheCanvas = new Canvas( {\n\t\t\t\tid: 'cc2',\n\t\t\t\twidth: canvasWidth,\n\t\t\t\theight: 90\n\t\t\t} );\n\t\t\tvar context = cacheCanvas.context;\n\t\t\tcontext.strokeStyle  = 'rgba(255,255,255,0.8)';\n\t\t\tcontext.lineWidth    = 6;\n\t\t\tcontext.textAlign    = 'center';\n\t\t\tcontext.textBaseline = 'middle';\n\t\t\t// Draw the tutor title\n\t\t\tif( typeof options.title === 'string' ) {\n\t\t\t\tcontext.font      = '14px Roboto, sans-serif';\n\t\t\t\tcontext.fillStyle = '#002856';\n\t\t\t\tcontext.strokeText( options.title.toUpperCase(), canvasWidth/2, -10+60/3 );\n\t\t\t\tcontext.fillText( options.title.toUpperCase(), canvasWidth/2, -10+60/3 );\n\t\t\t}\n\t\t\t// Then draw the instruction text\n\t\t\tcontext.font      = '13px Roboto, sans-serif';\n\t\t\tcontext.fillStyle = '#333';\n\t\t\tcontext.strokeText( 'Use the arrow keys or tap the', canvasWidth/2, 10+60*2/4 );\n\t\t\tcontext.strokeText( 'screen to navigate. Press \\'Esc\\'', canvasWidth/2, 10+60*3/4 );\n\t\t\tcontext.strokeText( 'or the \\'X\\' above ↗ to pause.', canvasWidth/2, 10+60 );\n\t\t\tcontext.fillText( 'Use the arrow keys or tap the', canvasWidth/2, 10+60*2/4 );\n\t\t\tcontext.fillText( 'screen to navigate. Press \\'Esc\\'', canvasWidth/2, 10+60*3/4 );\n\t\t\tcontext.fillText( 'or the \\'X\\' above ↗ to pause.', canvasWidth/2, 10+60 );\n\t\t\t// Check if the clearance rectangle needs to be increased\n\t\t\t// Calculate the width of what we just drew\n\t\t\tvar width = context.measureText( 'screen to navigate. Press \\'Esc\\'' ).width;\n\t\t\tcontext.font = '14px Roboto, sans-serif';\n\t\t\twidth = Math.max( width, context.measureText( options.title.toUpperCase() ).width );\n\t\t\t// Then increase the global clearance rectangle if needed\n\t\t\tif( Math.floor((canvasWidth - width)/2) < clearLeft ) {\n\t\t\t\tclearWidth = Math.max( width, clearWidth + clearLeft - Math.floor((canvasWidth - width)/2) );\n\t\t\t\tclearLeft = Math.floor( Math.max(0, (canvasWidth - width)/2));\n\t\t\t}\n\t\t\tclearWidth = Math.floor(Math.min(Math.max(clearWidth, canvasWidth - clearLeft - (canvasWidth-width)/2), canvasWidth - clearLeft));\n\t\t\treturn cacheCanvas;\n\t\t})();\n\t}\n\tif( options.thatsAll ) {\n\t\tvar fillTextCache_thatsAll = (function() {\n\t\t\tvar cacheCanvas = new Canvas( {\n\t\t\t\tid: 'cc3',\n\t\t\t\twidth: canvasWidth,\n\t\t\t\theight: 40\n\t\t\t} );\n\t\t\tvar context = cacheCanvas.context;\n\t\t\tcontext.font         = 'bold 15px Roboto, sans-serif';\n\t\t\tcontext.strokeStyle  = 'rgba(255,255,255,0.8)';\n\t\t\tcontext.lineWidth    = 4;\n\t\t\tcontext.fillStyle    = '#333';\n\t\t\tcontext.textAlign    = 'center';\n\t\t\tcontext.textBaseline = 'top';\n\t\t\tvar thatsAllString = (typeof options.thatsAll == 'string')? options.thatsAll : \"That's all!\";\n\t\t\tcontext.strokeText( thatsAllString, canvasWidth/2, 0 );\n\t\t\tcontext.fillText( thatsAllString, canvasWidth/2, 0 );\n\t\t\treturn cacheCanvas;\n\t\t})();\n\t\tvar fillTextCache_thatsAllFinished = (options.score)? false : true; // We'll need to draw on the final score later\n\t}\n\tvar fillTextCache_messagesText = (function() {\n\t\tvar m = {\n\t\t\tbyRow: [],\n\t\t\tcanvases: []\n\t\t},\n\t\t\ti = 0, width,\n\t\t\tmultiLineMatch = /^(\\d+)\\-(\\d+)$/;\n\t\tfor( var prop in options.messages) {\n\t\t\tprop.split( ',' ).forEach( function( pos ) {\n\t\t\t\tvar multiLineMatchResult = pos.match( multiLineMatch );\n\t\t\t\tif( multiLineMatchResult !== null ) {\n\t\t\t\t\tvar x = parseInt( multiLineMatchResult[1] ),\n\t\t\t\t\t\txLim = parseInt( multiLineMatchResult[2] );\n\t\t\t\t\twhile( x <= xLim ) {\n\t\t\t\t\t\tm.byRow[x] = i;\n\t\t\t\t\t\t++x;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if( !isNaN( parseInt( pos ) ) ) {\n\t\t\t\t\tm.byRow[parseInt( pos )] = i;\n\t\t\t\t}\n\t\t\t} );\n\t\t\tm.canvases[i] = new Canvas( {\n\t\t\t\tid: 'ccm'+i,\n\t\t\t\twidth: canvasWidth,\n\t\t\t\theight: 40\n\t\t\t} );\n\t\t\tvar context = m.canvases[i].context;\n\t\t\tcontext.font         = 'bold 12px Roboto, sans-serif';\n\t\t\tcontext.strokeStyle  = 'rgba(255,255,255,0.8)';\n\t\t\tcontext.lineWidth    = 4;\n\t\t\tcontext.fillStyle    = '#333';\n\t\t\tcontext.textAlign    = 'center';\n\t\t\tcontext.textBaseline = 'top';\n\t\t\tcontext.strokeText( options.messages[prop], canvasWidth/2, 0 );\n\t\t\tcontext.fillText( options.messages[prop], canvasWidth/2, 0 );\n\t\t\t++i;\n\t\t\t// See if we need to increase the amount of the canvas to clear to make sure the text is covered\n\t\t\twidth = context.measureText( options.messages[prop] ).width;\n\t\t\tif( Math.floor((canvasWidth - width)/2) < clearLeft ) {\n\t\t\t\tclearWidth = Math.max( width, clearWidth + clearLeft - Math.floor((canvasWidth - width)/2) );\n\t\t\t\tclearLeft = Math.floor( Math.max(0, (canvasWidth - width)/2));\n\t\t\t}\n\t\t\tclearWidth = Math.floor(Math.min(Math.max(clearWidth, canvasWidth - clearLeft - (canvasWidth-width)/2), canvasWidth - clearLeft));\n\t\t}\n\t\treturn m;\n\t})();\n\tvar fillTextCache_overlayMessagesText = (function() {\n\t\tvar m = [], width;\n\t\tfor( var i in options.overlayMessages) {\n\t\t\tm[i] = new Canvas( {\n\t\t\t\tid: 'ccom'+i,\n\t\t\t\twidth: canvasWidth,\n\t\t\t\theight: rowHeight\n\t\t\t} );\n\t\t\tvar context = m[i].context;\n\t\t\tcontext.font         = 'bold 12px Roboto, sans-serif';\n\t\t\tcontext.strokeStyle  = 'rgba(255,255,255,0.8)';\n\t\t\tcontext.lineWidth    = 4;\n\t\t\tcontext.fillStyle    = '#333';\n\t\t\tcontext.textAlign    = 'center';\n\t\t\tcontext.textBaseline = 'middle';\n\t\t\tcontext.strokeText( options.overlayMessages[i], canvasWidth/2, rowHeight/2 );\n\t\t\tcontext.fillText( options.overlayMessages[i], canvasWidth/2, rowHeight/2 );\n\t\t\t++i;\n\t\t\t// See if we need to increase the amount of the canvas to clear to make sure the text is covered\n\t\t\twidth = context.measureText( options.overlayMessages[i] ).width;\n\t\t\tif( Math.floor((canvasWidth - width)/2) < clearLeft ) {\n\t\t\t\tclearWidth = Math.max( width, clearWidth + clearLeft - Math.floor((canvasWidth - width)/2) );\n\t\t\t\tclearLeft = Math.floor( Math.max(0, (canvasWidth - width)/2));\n\t\t\t}\n\t\t\tclearWidth = Math.floor(Math.min(Math.max(clearWidth, canvasWidth - clearLeft - (canvasWidth-width)/2), canvasWidth - clearLeft));\n\t\t}\n\t\treturn m;\n\t})();\n\n\t// Precalculate all rows\n\tvar rows = [startRow.slice(0)];\n\trows.push( PlaceNotation.apply( notation[0], rows[0] ) );\n\tif( typeof finishRow === 'number' ) {\n\t\twhile( rows.length <= finishRow ) {\n\t\t\trows.push( PlaceNotation.apply( notation[(rows.length-1) % notation.length], rows[rows.length-1] ) );\n\t\t}\n\t}\n\telse {\n\t\twhile( rows.length < 10000 && !PlaceNotation.rowsEqual( finishRow, rows[rows.length-1] ) ) {\n\t\t\trows.push( PlaceNotation.apply( notation[(rows.length-1) % notation.length], rows[rows.length-1] ) );\n\t\t}\n\t}\n\n\t// Variables used during drawing\n\tvar context      = canvas.context;\n\tvar going        = false;\n\tvar canvasPaused = false;\n\tvar finished     = false;\n\tvar currentPos, nextPos, currentRow, targetRow, dotY, previousTimestamp, currentRowAtTimeOfLastTargetRowSet;\n\n\tvar setup = function() {\n\t\tcurrentPos = rows[0].indexOf( following );\n\t\tnextPos    = rows[1].indexOf( following );\n\t\tcurrentRow = 0;\n\t\ttargetRow  = 0;\n\t\tdotY       = canvasHeight/2;\n\t\tpreviousTimestamp = null;\n\t\tcurrentRowAtTimeOfLastTargetRowSet = 0;\n\t\tscoreboard.reset();\n\t\tfillTextCache_thatsAllFinished = false;\n\t\tfinished = false;\n\t};\n\tsetup();\n\n\t// Do everything required when the user successfully advances to the next row\n\tvar advance = function( direction ) {\n\t\tif( !going ) { return; }\n\t\t// Advance the various tracking variables\n\t\tcurrentPos = nextPos;\n\t\ttargetRow++;\n\t\tcurrentRowAtTimeOfLastTargetRowSet = currentRow;\n\t\tif( options.score ) { scoreboard.correct(); }\n\t\tbuttonFlash( direction, 'success' );\n\t\t// Stop if we're at the end\n\t\tif( targetRow + 2 > rows.length ) {\n\t\t\tgoing    = false;\n\t\t\tfinished = true;\n\t\t\tbuttons.show();\n\t\t\tpauseButton.hide();\n\t\t\tscoreboard.hide();\n\t\t\tcontrols.deactivate();\n\t\t}\n\t\telse {\n\t\t\tnextPos = rows[targetRow+1].indexOf( following );\n\t\t}\n\t};\n\n\t// Do everything required when there is an error\n\tvar error = function( direction ) {\n\t\tbuttonFlash( direction, 'error' );\n\t\terrorFlash( direction );\n\t\tif( options.score ) { scoreboard.error(); }\n\t\tif( typeof Android === 'object' ) { // JavascriptInterface added in Blueline Android app\n\t\t\tAndroid.buzz();\n\t\t}\n\t};\n\n\t// Stepper function for animation\n\tvar rowMoveDuration = changeSpeed;\n\tvar step = function( timestamp ) {\n\t\tvar redrawNeeded = false;\n\t\t// Do an initial draw if this is the first run\n\t\tif( previousTimestamp === null ) {\n\t\t\tpreviousTimestamp = timestamp;\n\t\t\tredrawNeeded = true;\n\t\t}\n\t\tif( !canvasPaused ) {\n\t\t\t// Animate the user's movement along the line\n\t\t\tif( currentRow < targetRow ) {\n\t\t\t\tvar rowsToMove = Math.min( targetRow - currentRow, ((previousTimestamp - timestamp)/rowMoveDuration)*(((timestamp - previousTimestamp)/rowMoveDuration)-2) * (targetRow - currentRowAtTimeOfLastTargetRowSet) );\n\t\t\t\tcurrentRow = Math.min( targetRow, currentRow + rowsToMove );\n\t\t\t\tdotY  += rowsToMove*rowHeight;\n\t\t\t\tredrawNeeded = true;\n\t\t\t}\n\t\t\t// Scroll up the line even if the user isn't moving\n\t\t\tif( dotY > canvasHeight/2 ) {\n\t\t\t\tdotY   = Math.min( canvasHeight - 28 - (fillTextCache_messagesText.byRow.length>0? 20 : 0), Math.max( canvasHeight/2, dotY - Math.max(0.05, (timestamp - previousTimestamp)*(canvasHeight/(rowMoveDuration*10))*Math.pow((dotY-(canvasHeight/2))/(canvasHeight/2), 2) ) ));\n\t\t\t\tredrawNeeded = true;\n\t\t\t}\n\t\t\tif( redrawNeeded ) { draw(); }\n\t\t}\n\t\tpreviousTimestamp = timestamp;\n\t\twindow.requestAnimationFrame( step );\n\t};\n\twindow.requestAnimationFrame( step );\n\n\t// Draws a frame at the current state\n\tvar draw = function() {\n\t\tvar i, j,\n\t\t\tx, y,\n\t\t\tcomingFromPosition, goingToPosition,\n\t\t\tcurrentRowCeil  = Math.ceil( currentRow ),\n\t\t\tcurrentRowFloor = Math.floor( currentRow );\n\n\t\t// Clear\n\t\tcontext.clearRect( clearLeft, 0, clearWidth, canvasHeight );\n\n\t\t// Draw background guides\n\t\tcontext.strokeStyle = '#BBB';\n\t\tcontext.lineWidth   = 0.5;\n\t\tcontext.setLineDash( [4,3] );\n\t\tcontext.lineCap     = 'butt';\n\t\tcontext.beginPath();\n\t\tfor( i = 0; i < stage; ++i ) {\n\t\t\t// I checked and it wasn't worth caching these\n\t\t\tcontext.moveTo( paddingForLeftMostPosition + (i*bellWidth), (dotY-(currentRow*rowHeight))%7 );\n\t\t\tcontext.lineTo( paddingForLeftMostPosition + (i*bellWidth), canvasHeight - 22 );\n\t\t}\n\t\tcontext.stroke();\n\n\t\t// Draw place guides\n\t\tcontext.drawImage( fillTextCache_guides.element, 0, canvasHeight - 22, canvasWidth, 22 );\n\n\t\t// Draw rules offs\n\t\tif( typeof options.ruleOffs === 'object' ) {\n\t\t\ty = 1;\n\t\t\tcontext.lineWidth = 1;\n\t\t\tcontext.setLineDash( [3,1] );\n\t\t\tfor( i = going? currentRowFloor+1 : currentRowFloor; y > 0 && i > 0; --i ) {\n\t\t\t\ty = dotY - (currentRowFloor-i+(currentRow%1)+0.5)*rowHeight;\n\t\t\t\tif( (i-options.ruleOffs.from)%options.ruleOffs.every === 0 ) {\n\t\t\t\t\tcontext.strokeStyle = (i==(currentRowFloor+1))? 'rgba(153,153,153,'+ Math.round((currentRow%1)*10)/10 +')' : '#999';\n\t\t\t\t\tcontext.beginPath();\n\t\t\t\t\tcontext.moveTo( paddingForLeftMostPosition - (bellWidth/3), y );\n\t\t\t\t\tcontext.lineTo( paddingForLeftMostPosition + ((stage-1)*bellWidth) + (bellWidth/3), y );\n\t\t\t\t\tcontext.stroke();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Draw place starts\n\t\tif( typeof options.placeStarts === 'object' ) {\n\t\t\tx = paddingForLeftMostPosition + (stage*bellWidth) + 5;\n\t\t\ty = 1;\n\t\t\tfor( i = going? currentRowCeil : currentRowCeil-(options.thatsAll?1:0); y > 0 && i >= 0; --i ) {\n\t\t\t\ty = dotY - (currentRowFloor-i+(currentRow%1)+0.5)*rowHeight;\n\t\t\t\tif( (i-options.placeStarts.from)%options.placeStarts.every === 0 ) {\n\t\t\t\t\tif( i == (currentRowFloor+1) ) { context.globalAlpha = currentRow%1; }\n\t\t\t\t\tcontext.drawImage( fillTextCache_placeStarts.element, Math.floor(rows[i].indexOf( following )*22*fillTextCache_placeStarts.scale), 0, Math.floor(22*fillTextCache_placeStarts.scale), Math.floor(22*fillTextCache_placeStarts.scale), x-11, y-11, 22, 22 );\n\t\t\t\t\tif( i == (currentRowFloor+1) ) { context.globalAlpha = 1; }\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Introduction message\n\t\tif( dotY - (currentRow*rowHeight) > 0 && options.introduction ) {\n\t\t\tcontext.drawImage( fillTextCache_introduction.element, 0, dotY - (currentRow*rowHeight) - 120, canvasWidth, 90 );\n\t\t}\n\n\t\t// That's all message\n\t\tif( finished && currentRow > 1 && options.thatsAll ) {\n\t\t\t// If we haven't drawn on the final score yet then do so\n\t\t\tif( !fillTextCache_thatsAllFinished && options.score ) {\n\t\t\t\tfillTextCache_thatsAll.context.clearRect( 0, ((options.thatsAll === ' ')? 0 : 15), canvasWidth, 15 );\n\t\t\t\tfillTextCache_thatsAll.context.font = '13px Roboto, sans-serif';\n\t\t\t\tfillTextCache_thatsAll.context.fillText( 'Score: '+scoreboard.score(), canvasWidth/2, ((options.thatsAll === ' ')? 5 : 20) );\n\t\t\t\tfillTextCache_thatsAllFinished = true;\n\t\t\t}\n\t\t\t// Otherwise just paste in the pre-rendered text\n\t\t\ty = dotY + (1 - ((currentRow%1 === 0)? 1 : currentRow%1))*rowHeight + 20;\n\t\t\tcontext.globalAlpha = (currentRow%1 === 0)? 1 : currentRow%1;\n\t\t\tcontext.drawImage( fillTextCache_thatsAll.element, 0, y, canvasWidth, 40 );\n\t\t\tcontext.globalAlpha = 1;\n\t\t}\n\n\t\t// Handstroke/Backstroke indicator\n\t\tif( options.hbIndicator !== 0 ) {\n\t\t\tvar toI, fromI;\n\t\t\tif( ( currentRowFloor%2 === 0 && options.hbIndicator === 1 ) || ( currentRowFloor%2 === 1 && options.hbIndicator === -1 ) ) {\n\t\t\t\ttoI   = fillTextCache_hIndicator.element;\n\t\t\t\tfromI = fillTextCache_bIndicator.element;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfromI = fillTextCache_hIndicator.element;\n\t\t\t\ttoI   = fillTextCache_bIndicator.element;\n\t\t\t}\n\t\t\tif( currentRow%1 === 0 ) {\n\t\t\t\tcontext.drawImage( fromI, paddingForLeftMostPosition-bellWidth-8, dotY-8, 16, 16 );\n\t\t\t}\n\t\t\telse if( currentRow%1 > 0.66 ) {\n\t\t\t\tcontext.drawImage( toI, paddingForLeftMostPosition-bellWidth-8, dotY-8, 16, 16 );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcontext.globalAlpha = (currentRow%1)/0.66;\n\t\t\t\tcontext.drawImage( toI, paddingForLeftMostPosition-bellWidth-8, dotY-8, 16, 16 );\n\t\t\t\tcontext.globalAlpha = 1 - ((currentRow%1)/0.66);\n\t\t\t\tcontext.drawImage( fromI, paddingForLeftMostPosition-bellWidth-8, dotY-8, 16, 16 );\n\t\t\t\tcontext.globalAlpha = 1;\n\t\t\t}\n\t\t}\n\n\t\t// Draw the lines\n\t\tif( currentRow > 0 ) {\n\t\t\tcontext.setLineDash( [] );\n\t\t\tcontext.lineCap  = 'round';\n\t\t\tcontext.lineJoin = 'round';\n\t\t\tfor( i = 0; i < options.lines.length; ++i ) {\n\t\t\t\tif( options.lines[i] === null || typeof options.lines[i].color !== 'string' ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tcomingFromPosition = rows[currentRowFloor].indexOf( i );\n\t\t\t\tgoingToPosition    = rows[currentRowCeil].indexOf( i );\n\t\t\t\tx = paddingForLeftMostPosition + (bellWidth * ((currentRow == currentRowCeil)? goingToPosition : comingFromPosition + ((currentRow%1)*(goingToPosition - comingFromPosition)) ));\n\t\t\t\ty = dotY;\n\t\t\t\tcontext.strokeStyle = options.lines[i].color;\n\t\t\t\tcontext.lineWidth   = options.lines[i].width;\n\t\t\t\tcontext.beginPath();\n\t\t\t\tcontext.moveTo( x, y );\n\t\t\t\tx  = paddingForLeftMostPosition + (bellWidth * ((currentRow == currentRowCeil)? goingToPosition : comingFromPosition ));\n\t\t\t\ty -= (currentRow - currentRowFloor)*rowHeight;\n\t\t\t\tcontext.lineTo( x, y );\n\t\t\t\tfor( j = 1; (typeof rows[currentRowFloor-j] !== 'undefined') && y > 0; j++ ) {\n\t\t\t\t\tx  = paddingForLeftMostPosition + (bellWidth * rows[currentRowFloor-j].indexOf( i ));\n\t\t\t\t\ty -= rowHeight;\n\t\t\t\t\tcontext.lineTo( x, y );\n\t\t\t\t}\n\t\t\t\tcontext.stroke();\n\t\t\t}\n\t\t}\n\n\t\t// Draw the user's dot\n\t\tcomingFromPosition = rows[currentRowFloor].indexOf( following );\n\t\tgoingToPosition    = rows[currentRowCeil].indexOf( following );\n\t\tx = paddingForLeftMostPosition + (bellWidth * ((currentRow == currentRowCeil)? goingToPosition : comingFromPosition + ((currentRow%1)*(goingToPosition - comingFromPosition)) ));\n\t\ty = dotY;\n\t\tcontext.fillStyle = options.lines[following].color;\n\t\tcontext.beginPath();\n\t\tcontext.arc( x, y, 4, 0, Math.PI*2, true );\n\t\tcontext.closePath();\n\t\tcontext.fill();\n\n\t\t// Draw messages\n\t\tif( fillTextCache_messagesText.byRow.length > 0 && (typeof fillTextCache_messagesText.byRow[currentRowFloor] !== 'undefined' || typeof fillTextCache_messagesText.byRow[currentRowCeil] !== 'undefined') ) {\n\t\t\tif( fillTextCache_messagesText.byRow[currentRowCeil] === fillTextCache_messagesText.byRow[currentRowFloor] ) {\n\t\t\t\tcontext.drawImage( fillTextCache_messagesText.canvases[fillTextCache_messagesText.byRow[currentRowFloor]].element, 0, dotY + 15, canvasWidth, 40 );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif( typeof fillTextCache_messagesText.byRow[currentRowCeil] !== 'undefined' ) {\n\t\t\t\t\tcontext.globalAlpha = currentRow%1;\n\t\t\t\t\tcontext.drawImage( fillTextCache_messagesText.canvases[fillTextCache_messagesText.byRow[currentRowCeil]].element, 0, dotY + 15, canvasWidth, 40 );\n\t\t\t\t}\n\t\t\t\tif( typeof fillTextCache_messagesText.byRow[currentRowFloor] !== 'undefined' ) {\n\t\t\t\t\tcontext.globalAlpha = 1 - (currentRow%1);\n\t\t\t\t\tcontext.drawImage( fillTextCache_messagesText.canvases[fillTextCache_messagesText.byRow[currentRowFloor]].element, 0, dotY + 15, canvasWidth, 40 );\n\t\t\t\t}\n\t\t\t\tcontext.globalAlpha = 1;\n\t\t\t}\n\t\t}\n\n\t\t// Draw overlay messages\n\t\tif( fillTextCache_overlayMessagesText.length > 0 ) {\n\t\t\tvar minOverlayMessage = Math.max( 0, Math.floor( ((currentRow*rowHeight) - dotY)/rowHeight ) ),\n\t\t\t\tmaxOverlayMessage = Math.ceil( Math.min( currentRow + 3,  ( (canvasHeight - dotY) + (currentRow*rowHeight))/rowHeight ) );\n\t\t\tfor( i = minOverlayMessage; i < maxOverlayMessage; ++i ) {\n\t\t\t\tif( typeof fillTextCache_overlayMessagesText[i] !== 'undefined' ) {\n\t\t\t\t\tif( i + 1 >= maxOverlayMessage && currentRow%1 > 0  ) {\n\t\t\t\t\t\tcontext.globalAlpha = currentRow%1;\n\t\t\t\t\t\tcontext.drawImage( fillTextCache_overlayMessagesText[i].element, 0, dotY - (3/2 + currentRow - i)*rowHeight, canvasWidth, rowHeight );\n\t\t\t\t\t\tcontext.globalAlpha = 1;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tcontext.drawImage( fillTextCache_overlayMessagesText[i].element, 0, dotY - (3/2 + currentRow - i)*rowHeight, canvasWidth, rowHeight );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\n\t// Functions which try to go left/down/right\n\tvar left = function() {\n\t\tif( going ) {\n\t\t\tif( nextPos - currentPos <= -1 ) { advance( 'left' ); }\n\t\t\telse                             { error( 'left' ); }\n\t\t}\n\t};\n\tvar down = function() {\n\t\tif( going ) {\n\t\t\tif( nextPos - currentPos === 0 ) { advance( 'down' ); }\n\t\t\telse                             { error( 'down' ); }\n\t\t}\n\t};\n\tvar right = function() {\n\t\tif( going ) {\n\t\t\tif( nextPos - currentPos >= 1 ) { advance( 'right' ); }\n\t\t\telse                            { error( 'right' ); }\n\t\t}\n\t};\n\tdocument.body.addEventListener( 'keydown', function( e ) {\n\t\tif( going ) {\n\t\t\tswitch( e.key ) {\n\t\t\t\tcase 'ArrowLeft':\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tleft();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'ArrowDown':\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tdown();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'ArrowRight':\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tright();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Shift':\n\t\t\t\t\trowMoveDuration = changeSpeed*10;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Escape':\n\t\t\t\tcase ' ':\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tpauseButton.element.dispatchEvent( new Event( 'click' ) );\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t} );\n\tdocument.body.addEventListener( 'keyup', function( e ) {\n\t\tif( going ) {\n\t\t\tswitch( e.key ) {\n\t\t\t\tcase 'Shift':\n\t\t\t\t\trowMoveDuration = changeSpeed;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t} );\n\tcontainer.addEventListener( 'touchstart', function( e ) {\n\t\tvar touch = e.touches[0],\n\t\t\tcontainerRect = container.getBoundingClientRect(),\n\t\t\tposX = (touch.clientX - containerRect.left) / containerRect.width;\n\t\tif( going && touch.pageY - containerRect.top > 30 ) {\n\t\t\te.preventDefault(); // This prevents click emulation, so the click event below won't fire as well\n\t\t\tif( posX <= 0.33 )      { left(); }\n\t\t\telse if( posX >= 0.66 ) { right(); }\n\t\t\telse                    { down(); }\n\t\t}\n\t} );\n\tcontainer.addEventListener( 'click', function( e ) {\n\t\tvar classes = e.target.className.split( /\\s+/ );\n\t\tif( classes.indexOf( 'practice_controls_left' ) !== -1 )       { left(); }\n\t\telse if( classes.indexOf( 'practice_controls_down' ) !== -1 )  { down(); }\n\t\telse if( classes.indexOf( 'practice_controls_right' ) !== -1 ) { right(); }\n\t} );\n\n\t// Autostart\n\tif( options.autostart && !going ) {\n\t\tgoing = true;\n\t\tcanvasPaused = false;\n\t\tsetup();\n\t\tbuttons.hide();\n\t\tpauseButton.show();\n\t\tcontrols.activate();\n\t\tscoreboard.show();\n\t\tcanvas.element.className = 'visible';\n\t\tdraw();\n\t}\n};\n\nexport default RingingPractice;\n","import ready from '../lib/ready.js';\nimport RingingPractice from '../lib/RingingPractice.js';\nimport PlaceNotation from '../lib/PlaceNotation.js';\n\nready(function() {\n    // Listen for clicks to the Go button, and destroy then re-create the practice interface\n    document.getElementById( 'go' ).addEventListener( 'click', function( e ) {\n        var i;\n\n        // Clear the existing interface\n        var practice_container = document.getElementById( 'practice_container' );\n        practice_container.innerHTML = '';\n        practice_container.replaceWith( practice_container.cloneNode(true) );\n\n        // Read some options into variables\n        var option_title = document.getElementById( 'practice_chooser_name' ).value,\n            option_leadOrCourse = document.querySelector( '#practice_chooser_leadOrCourse li.active input' ).value,\n            option_stage = parseInt( document.getElementById( 'practice_chooser_stage' ).value, 10 ),\n            option_notation = PlaceNotation.parse( PlaceNotation.expand( document.getElementById( 'practice_chooser_notation' ).value, option_stage ), option_stage ),\n            option_following = parseInt( practice_chooser_bell.querySelector( 'li.active input' ).value, 10 ) - 1;\n\n        // Read off rule offs\n        var option_ruleOffs = {};\n        try {\n            option_ruleOffs = JSON.parse( document.getElementById( 'practice_chooser_ruleOffs' ).value );\n        }\n        catch(e) {\n            var option_ruleOffs = { from: 0, every: option_notation.length };\n        }\n\n        // Work out which bells to draw lines through\n        var option_lines = new Array( option_stage ),\n            huntBells = PlaceNotation.huntBells( option_notation, option_stage );\n        for( i = 0; i < option_stage; ++i ) {\n            if( huntBells.indexOf( i ) !== -1 ) {\n                option_lines[i] = { color: '#D11', width: 2 };\n            }\n            else {\n                option_lines[i] = null\n            }\n        }\n        option_lines[option_following] = { color: (huntBells.indexOf( option_following ) !== -1)? '#D11' : '#11D', width: 4 };\n\n        // Create a new ringing practice interface\n        var practice = new RingingPractice( {\n            container: 'practice_container',\n            title: option_title,\n            stage: option_stage,\n            notation: option_notation,\n            following: option_following,\n            lines: option_lines,\n            ruleOffs: option_ruleOffs,\n            introduction: true,\n            score: true,\n            thatsAll: (option_leadOrCourse === 'course')? \"That's all!\" : ' ',\n            finishRow: (option_leadOrCourse === 'course')? false : option_notation.length,\n            placeStarts: { from: 0, every: option_notation.length },\n            autostart: true,\n            buttons: [{text: '↑ Exit', className: 'plain', callback: function() { document.querySelector( '#tutor .prev_button button' ).dispatchEvent( new Event( 'click', { bubbles: true } ) ); }}]\n        } );\n    } );\n});\n","// ES module entry point\nimport ready from './lib/ready.js';\nimport ServiceWorker from './lib/ServiceWorker.js';\nimport Hash from './ui/Hash.js';\n// Import UI modules for side-effects\nimport './ui/About.js';\nimport './ui/Sections.js';\nimport './ui/ChooseOptions.js';\nimport './ui/SelectMethod.js';\nimport './ui/Tutor.js';\n\nready(function() {\n    // Load service worker\n    ServiceWorker.load();\n    // Read data from the URL hash\n    Hash.read();\n});\n"],"mappings":"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","ignoreList":[]}