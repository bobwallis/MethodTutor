!function(){"use strict";var ready=function(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)};const e={load(){"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js")}};function $document_on(e,t,n){e.split(" ").forEach((function(e){document.addEventListener(e,(function(e){if(e.target){var o=e.target.closest(t);if(null===o)return;n.call(o,e)}}))}))}var t,parseCurrentHash=function(){for(var e=window.location.hash,t={},n=("#"===e[0]?e.substring(1):e).split("&"),o=0;o<n.length;o++){var a=n[o].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1]||"")}return t},Hash_read=function(){var e,n=parseCurrentHash();for(e in t)void 0!==n[e]&&""!==n[e]&&(t[e].value=n[e]);for(e in t)void 0!==n[e]&&""!==n[e]&&t[e].dispatchEvent(new Event("change",{bubbles:!0}));void 0!==n.title&&void 0!==n.notation&&void 0!==n.stage&&document.querySelector("#selectMethod .next_button button").dispatchEvent(new Event("click",{bubbles:!0}))},Hash_update=function(e){var n,o,a=parseCurrentHash();for(o in t)t[o].id!==e.target.id&&void 0===a[o]||(a[o]=t[o].value);var r=Object.entries(a).filter((function(e){return e[1]}));n=Object.keys(Object.fromEntries(r)).map((function(e){return e+"="+encodeURIComponent(a[e])})).join("&"),history.replaceState(void 0,void 0,"#"+n)};ready((function(){$document_on("change","select, input",Hash_update),window.addEventListener("hashchange",Hash_read),t={title:document.getElementById("practice_chooser_name"),stage:document.getElementById("practice_chooser_stage"),notation:document.getElementById("practice_chooser_notation"),ruleoffs:document.getElementById("practice_chooser_ruleOffs"),allowMethodSelection:document.getElementById("practice_chooser_allowMethodSelection")}})),ready((function(){var e=document.getElementById("about"),t=document.createElement("div");t.id="overlay",t.className="hide",document.body.insertBefore(t,e);var n=!1,toggleAbout=function(){n?closeAbout():openAbout()},openAbout=function(){t.className="active",e.className="active",n=!0},closeAbout=function(){t.className="hide",e.className="hide",n=!1};document.getElementById("aboutButton").addEventListener("click",toggleAbout),t.addEventListener("click",toggleAbout),document.getElementById("head").addEventListener("click",(function(e){e.target.matches("#aboutButton")||closeAbout()})),document.body.addEventListener("keydown",(function(e){"Escape"===e.key&&closeAbout()}))})),ready((function(){$document_on("click",".prev_button button",(function(e){this.parentNode.parentNode.classList.remove("active"),this.parentNode.parentNode.classList.remove("up"),this.parentNode.parentNode.classList.add("down"),this.parentNode.parentNode.previousElementSibling.classList.add("active"),this.parentNode.parentNode.previousElementSibling.classList.remove("up"),this.parentNode.parentNode.previousElementSibling.classList.remove("down")})),$document_on("click",".next_button button",(function(e){this.parentNode.parentNode.classList.remove("active"),this.parentNode.parentNode.classList.add("up"),this.parentNode.parentNode.classList.remove("down"),this.parentNode.parentNode.nextElementSibling.classList.add("active"),this.parentNode.parentNode.nextElementSibling.classList.remove("up"),this.parentNode.parentNode.nextElementSibling.classList.remove("down")}))})),ready((function(){for(var e=document.querySelectorAll("ul.tab_group input[type=radio]"),t=0;t<e.length;t++)e[t].addEventListener("click",(function(e){for(var t=e.target.parentElement.parentElement.firstChild;t&&1===t.nodeType;t=t.nextElementSibling||t.nextSibling)t.classList.remove("active");e.target.parentElement.classList.add("active")}));var n=document.getElementById("practice_chooser_bell");document.getElementById("practice_chooser_stage").addEventListener("change",(function(e){var t=parseInt(e.target.value,10),o=parseInt(n.querySelector("li.active input").value,10);if(n.className="tab_group _"+t,t<o){var a=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});n.querySelector("input#practice_chooser_bell_"+t).dispatchEvent(a)}}));var o=document.querySelector("#chooseOptions h3");document.getElementById("practice_chooser_name").addEventListener("change",(function(e){o.innerText=e.target.value}))})),ready((function(){var e=document.getElementById("selectMethod"),t=document.getElementById("practice_chooser_name"),n=document.getElementById("practice_chooser_stage"),o=document.getElementById("practice_chooser_notation"),a=document.getElementById("practice_chooser_ruleOffs"),r=document.getElementById("practice_chooser_allowMethodSelection"),i=document.getElementById("practice_chooser_help"),l=document.getElementById("searchResults");r.addEventListener("change",(function(){if("false"===r.value){var e=document.querySelector("#chooseOptions .prev_button");e.style.pointerEvents="none",e.style.opacity=0,document.querySelector("#chooseOptions h3").style.display="none",document.querySelector("#head h1").innerHTML=""!==t.value?'<span style="font-weight:normal">Method Tutor &raquo;</span> '+t.value:"Method Tutor"}}));var c=0,s=-1;t.addEventListener("input",(function(e){if(""!==e.target.value){var t=c;c++,fetch("https://rsw.me.uk/blueline/methods/search.json?q="+encodeURIComponent(e.target.value)).then((function(e){if(t<s)throw Error("Ignored result received out of sync");return s=t,e.json()})).then((function(e){for(var t="",n=0;n<4&&void 0!==e.results[n];n++)t+='<li class="result" data-stage="'+e.results[n].stage+'" data-notation="'+e.results[n].notation+'" data-ruleOffs="{&quot;from&quot;:'+e.results[n].ruleOffs.from+",&quot;every&quot;:"+e.results[n].ruleOffs.every+'}">'+e.results[n].title+"</li>";l.innerHTML=t+='<li class="close">Close Search Results ✖</li>',l.style.marginBottom=-33*n+"px",l.style.display="block"})).catch((function(e){console.log(e)}))}else l.style.display="none"}));var u=document.querySelector("#selectMethod .next_button"),pnChange=function(e){""===o.value?(u.style.pointerEvents="none",u.style.opacity=0):(u.style.pointerEvents="auto",u.style.opacity=1)};o.addEventListener("change",pnChange),o.addEventListener("input",pnChange);var d=document.querySelector("#selectMethod .prev_button"),titleChange=function(e){""===t.value?(d.style.pointerEvents="none",d.style.opacity=0,i.classList.add("pulse")):(d.style.pointerEvents="auto",d.style.opacity=1,i.classList.remove("pulse"))};t.addEventListener("change",titleChange),t.addEventListener("input",titleChange),document.querySelector('#selectMethod input[type="reset"]').addEventListener("click",(function(e){t.value="",o.value="",n.value="",a.value="",t.dispatchEvent(new Event("change",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0})),t.focus()})),$document_on("click","#searchResults li.result",(function(e){t.value=e.target.innerText,o.value=e.target.dataset.notation,n.value=e.target.dataset.stage,a.value=e.target.dataset.ruleoffs,t.dispatchEvent(new Event("change",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0})),l.style.display="none"})),$document_on("click","#searchResults li.close",(function(e){l.style.display="none"})),document.body.addEventListener("keydown",(function(n){e.classList.contains("active")&&"/"==n.key&&"practice_chooser_name"!==document.activeElement.id&&(t.focus(),n.preventDefault())})),$document_on("mouseover","#searchResults li.result",(function(e){for(var t=e.target.parentElement.children,n=0;n<t.length;n++)t[n].classList.remove("active");e.target.classList.add("active")})),$document_on("mouseout","#searchResults li.result",(function(e){e.target.classList.remove("active")})),document.body.addEventListener("keydown",(function(e){if("block"===l.style.display){if("Escape"===e.key)return document.querySelector("#searchResults li.close").dispatchEvent(new Event("click",{bubbles:!0})),void e.preventDefault();var t,n;if("Enter"===e.key)return void(null!==(t=document.querySelector("#searchResults li.active"))&&(t.dispatchEvent(new Event("click",{bubbles:!0})),e.preventDefault()));if("ArrowUp"===e.key||"ArrowDown"===e.key)return null!==(t=document.querySelector("#searchResults li.active"))&&"ArrowUp"===e.key&&(n=t.previousSibling),null===t&&"ArrowDown"===e.key&&(n=document.querySelector("#searchResults li")),null!==t&&"ArrowDown"===e.key&&null===(n=t.nextSibling)&&(n=document.querySelector("#searchResults li")),null!==t&&t.dispatchEvent(new Event("mouseout",{bubbles:!0})),null!==n&&n.dispatchEvent(new Event("mouseover",{bubbles:!0})),void e.preventDefault()}}))}));var n={bellToCharMap:["1","2","3","4","5","6","7","8","9","0","E","T","A","B","C","D","F","G","H","J","K","L","M","N","P","Q","R","S","U","V","W","Y","Z"],bellToChar:function(e){return n.bellToCharMap[parseInt(e,10)]},charToBell:function(e){var t=parseInt(e,10);if(isNaN(t)||0===t){if(-1===(t=n.bellToCharMap.indexOf(e)))return null}else--t;return t},expand:function(e,t){var o,a,r;if(o=e.toUpperCase().replace(/X/g,"x").replace(/[{<].*[}>]/,"").replace(/ FCH.*$/,"").replace(/\.?x\.?/g,"x").trim(),void 0===t&&(t=Math.max.apply(Math,e.replace(/( HL |LH|LE)/g,"").split("").map(n.charToBell).filter((function(e){return"number"==typeof e})))+1),r=n.bellToChar(t-1),null!==(a=o.match(/^([^-]+)-([^-\.,x]+)$/))&&(o=n.expandHalf(a[1])+a[2]),-1!==(o=o.replace(/-/g,"x")).indexOf(" HL ")&&(o=o.replace(" HL ",".")),null!==(a=o.match(/^&?(.*)(LH|LE)/))&&(o=o.replace(a[0],n.expandHalf(a[1]))),-1!==o.indexOf(",")){var i=o.split(",").map((function(e){return e.trim()}));i.reduce((function(e,t){return e&&("&"==t.charAt(0)||"+"==t.charAt(0))}),!0)&&(o=i.reduce((function(e,t){return e+"."+("&"==t.charAt(0)?n.expandHalf(t):t.replace("+",""))}),""))}return null!==(a=o.match(/^\s*&?\s*(.*),(.*)/))&&(o=(n.expandHalf(a[1])+"."+n.expandHalf(a[2])).replace(/\.?x\.?/g,"x")),null!==(a=(o=o.replace(/\+/g," ")).match(/^([A-S]{1}[1-9]?)\s+(.*)$/))&&(t%2==0?/^[A-F]{1}/.test(a[1])?o=a[2]+" 12":/^[G-M]{1}/.test(a[1])?o=a[2]+" 1"+r:/^[P-Q]{1}/.test(a[1])&&(o=0===a[2].indexOf("3")?a[2]:"3"+r+" "+a[2]):o=/^[A-F]{1}/.test(a[1])?0===a[2].indexOf("3")?a[2]:"3 "+a[2]:/^[G-M]{1}/.test(a[1])?0===a[2].indexOf(r)?a[2]:r+" "+a[2]:/^[P-Q]{1}/.test(a[1])?a[2]+" 12"+r:a[2]+" 1"),null!==(a=o.match(/^(.*)Z\s+(.*)$/))&&(o=a[2]+" "+a[1]),null!==(a=o.match(/^&(.*)\s+([^x.]+)$/))&&(o=n.expandHalf(a[1])+" "+a[2]),o=o.replace(/\s+/g,".").replace(/(^\.+|\.+$)/g,"").replace(/\.+/g,".").replace(/\.?x\.?/g,"x"),n.explode(o).map((function(e){if("x"===e)return t%2==0?"x":r;if(null===e.match(/[A-Z\d]+/g))return"";var o=e.match(/[A-Z\d]+/g).join("").split("").map(n.charToBell).sort((function(e,t){return e-t}));return(o[0]+1)%2==0&&(e="1"+e),(t%2==0?(o[o.length-1]+1)%2!=0:(o[o.length-1]+1)%2==0)&&(e+=r),[].concat.apply([],e.replace(/\(/g,"~(").replace(/\)/g,")~").replace(/\[/g,"~[").replace(/\]/g,"]~").split("~").filter((function(e){return""!==e})).map((function(e){return"("==e.charAt(0)||"["==e.charAt(0)?{sort:Math.max.apply(Math,e.split("").map(n.charToBell)),value:e}:e.split("").map((function(e){return{sort:n.charToBell(e),value:e}}))}))).sort((function(e,t){return e.sort-t.sort})).map((function(e){return e.value})).join("")})).join(".").replace(/\.?x\.?/g,"x")},expandHalf:function(e){var t=(e=e.replace(/^&/,"")).split("").reverse().join("").replace(/\)(.+?)\(/g,(function(e,t){return"("+t+")"})).replace(/\](.+?)\[/g,(function(e,t){return"["+t.split("").reverse().join("")+"]"})),n=-1===t.indexOf(".")?9999:t.indexOf("."),o=-1===t.indexOf("x")?9999:t.indexOf("x");return n<0&&o<0?e:(e+t.substring(n<0||o<n?0===o?1:o:n)).replace(/\.?(x|-)\.?/g,"x").trim()},parse:function(e,t){var n,o,a,r,i=[],l=this.explode(e),c=Array(t);for(n=0;n<t;n+=2)c[n]=n+1,c[n+1]=n;for(n-1===t&&(c[n-1]=n-1),n=0;n<l.length;n++)if("x"===l[n])i.push(c);else{var s=Array(t),u=l[n].split("");for(o=0;o<u.length;o++)if("("===u[o]){var d=this.charToBell(u[o+1]),h=this.charToBell(u[o+2]);if(s[h]=d,d<h)for(a=d;a<h;a++)s[a]=a+1;else for(a=d;a>h;a--)s[a]=a-1;o+=3}else if("["===u[o]){++o,a=u.indexOf("]",o),r=0;for(var f=Math.min.apply(Math,u.slice(o,a).map(this.charToBell));o<a;)s[f+r]=this.charToBell(u[o]),++o,++r}else{var p=this.charToBell(u[o]);s[p]=p}for(o=0;o<t;o++)void 0===s[o]&&(void 0===s[o+1]&&o+1<t?(s[o]=o+1,s[o+1]=o,o++):s[o]=o);i.push(s)}return i},implode:function(e){return"function"==typeof e.join?e.join(".").replace(/\.?x\.?/g,"x"):e},explode:function(e){return"string"==typeof e?e.replace(/x/gi,".x.").split(".").filter((function(e){return""!==e})):e},rounds:function(e){for(var t=Array(e),n=e;n--;)t[n]=n;return t},backRounds:function(e){return n.rounds(e).reverse()},queens:function(e){if(e<4)throw Error("Stage must be >= 4 for Queens notation.");if(e%2==1)return n.queens(e+1).slice(1).map((function(e){return--e}));for(var t=Array(e),o=e,a=Math.ceil(e/2);o-- >a;)t[o]=1+2*(o-a);do{t[o]=2*o}while(o--);return t},kings:function(e){var t=Math.floor(e/2),o=n.queens(e);return o.slice(0,t).reverse().concat(o.slice(t))},tittums:function(e){if(e%2==1)return n.tittums(e+1).slice(1).map((function(e){return--e}));for(var t=Array(e),o=e,a=Math.floor(e/2);o--;)t[o]=Math.ceil(o/2)+(o%2==0?0:a);return t},whittingtons:function(e){if(e<6)throw Error("Stage must be >= 6 for Whittingtons notation.");if(e%2==1)return n.whittingtons(e+1).slice(1).map((function(e){return--e}));for(var t=Array(e),o=e,a=Math.floor(e/2);o-- >e-3;)t[o]=1+2*(o-a);for(t[o]=t[o+1]-1,t[--o]=t[o+1]+2,o&&(t[--o]=t[o+1]+2);o--;)t[o]=o;return t},rowsEqual:function(e,t){var n=e.length;if(n!==t.length)return!1;for(;n--;)if(e[n]!==t[n])return!1;return!0},allRows:function(e,t){for(var n=[t],o=0,a=e.length;o<a;)n.push(this.apply(e[o],n[o])),++o;return n},apply:function(e,t){var n;if("function"==typeof e[0].forEach)return n=t,e.forEach((function(e){n=this.apply(e,n)}),this),n;var o=e.length,a=t.length;for(n=Array(a);a-- >o;)n[a]=t[a];do{n[a]=t[e[a]]}while(a--);return n},cycles:function(e){for(var t,n,o=[],a=e.length,r=this.rounds(a);a--;)if(-1!==r[a]){for(t=[r[a]],n=e;n[a]!==r[a];n=this.apply(e,n))t.push(n[a]),r[n[a]]=-1;r[a]=-1,o.push(t)}return o},huntBells:function(e,t){for(var n=this.rounds(t),o=this.apply(e,n),a=[],r=0;r<t;++r)n[r]===o[r]&&a.push(r);return a}},Canvas=function(e){var t=location.href.replace(/^.*?(\?|$)/,""),n="number"==typeof e.scale?e.scale:-1!==t.indexOf("scale=")?parseInt(t.replace(/^.*scale=(.*?)(&.*$|$)/,"$1")):"number"==typeof window.devicePixelRatio?window.devicePixelRatio:1,o=document.createElement("canvas");return o.setAttribute("id",e.id),o.setAttribute("width",e.width*n),o.setAttribute("height",e.height*n),o.style.width=e.width+"px",o.style.height=e.height+"px",this.width=e.width,this.height=e.height,this.element=o,this.context=o.getContext("2d"),this.scale=n,1!==n&&this.context.scale(n,n),this.context.setLineDash||(this.context.setLineDash=function(){}),this.context.fillText||(this.context.fillText=function(){}),this};Canvas.prototype={type:"canvas"};var o="mt_",a=document.getElementsByTagName("html")[0].getAttribute("data-age"),r={age:parseInt(a),getItem:function(e){return JSON.parse(localStorage.getItem(o+e))},setItem:function(e,t){localStorage.setItem(o+e,JSON.stringify(t))},removeItem:function(e){localStorage.removeItem(o+e)},clear:function(){localStorage.clear()},getCache:function(e){return r.getItem("cache_"+e)},setCache:function(e,t){r.setItem("cache_"+e,t)},removeCache:function(e){r.removeItem("cache_"+e)}},i=RegExp("(^mt_cache_.*|^mt_Offset.*|^mt_Width.*)");r.clearCache=function(){for(var e,t=[],n=0;n<localStorage.length;++n)null!==(e=localStorage.key(n)).match(i)&&t.push(e);t.forEach((function(e){localStorage.removeItem(e)}))},r.getSetting=function(e,t){var n=r.getItem("setting_"+e);return null===n?t:n},r.setSetting=function(e,t){r.setItem("setting_"+e,t)},r.removeSetting=function(e){r.removeItem("setting_"+e)};var l=RegExp("^mt_setting_.*");r.clearSettings=function(){for(var e,t=[],n=0;n<localStorage.length;++n)null!==(e=localStorage.key(n)).match(l)&&t.push(e);t.forEach((function(e){localStorage.removeItem(e)}))};var c=r.getItem("cacheAge");null===c&&(c=0),c<r.age&&(r.clearCache(),r.setItem("cacheAge",r.age));var measureXAndYTextPadding=function(e,t,n){void 0===n&&(n="0");var o=r.getCache("Offset."+t+n);if(null===o){var a=new Canvas({id:"metric"+Math.floor(100*Math.random()+1),width:3*e,height:3*e,scale:"number"==typeof window.devicePixelRatio?Math.round(8*window.devicePixelRatio):8});if(!1!==a)try{var i=a.context;i.font=t,i.textAlign="center",i.textBaseline="middle",i.fillStyle="#F00",i.fillText(n,1.5*e,1.5*e);var l,c,s=3*e*a.scale,u=i.getImageData(0,0,s,s),d=!1,h=!1,f=!1,p=!1;for(l=0;!1===h&&l<s;++l)for(c=0;c<s;++c)if(u.data[l*(4*s)+4*c]>0){h=l;break}for(l=s;!1===d&&l>0;--l)for(c=0;c<s;++c)if(u.data[l*(4*s)+4*c]>0){d=l+1;break}for(c=0;!1===f&&c<s;++c)for(l=0;l<s;++l)if(u.data[l*(4*s)+4*c]>0){f=c;break}for(c=s;!1===p&&c>0;--c)for(l=0;l<s;++l)if(u.data[l*(4*s)+4*c]>0){p=c+1;break}r.setCache("Offset."+t+n,o={x:Math.round(1e3*(s-p-f)/(2*a.scale))/1e3,y:Math.round(1e3*(s-d-h)/(2*a.scale))/1e3})}catch(e){o.x=o.y=0}a=null}return o},RingingPractice=function(e){var t="string"==typeof e.container?document.getElementById(e.container):e.container,o=parseInt(e.stage),a="string"==typeof e.notation?n.parse(n.expand(e.notation,o),o):e.notation,r="string"==typeof e.startRow?e.startRow.split("").map(n.charToBell):"object"==typeof e.startRow?e.startRow.slice(0):n.rounds(o),i="string"==typeof e.finishRow?e.finishRow.split("").map(n.charToBell):"object"==typeof e.finishRow?e.finishRow.slice(0):"number"==typeof e.finishRow?Math.floor(e.finishRow):n.rounds(o),l=e.following;"boolean"!=typeof e.score&&(e.score=!1),"boolean"!=typeof e.introduction&&(e.introduction=!1),"boolean"!=typeof e.autostart&&(e.autostart=!1),"[object Array]"!==Object.prototype.toString.call(e.buttons)&&(e.buttons=[]),"boolean"!=typeof e.thatsAll&&"string"!=typeof e.thatsAll&&(e.thatsAll=!1),"boolean"==typeof e.hbIndicator&&(e.hbIndicator=0|e.hbIndicator),1!==e.hbIndicator&&-1!==e.hbIndicator&&(e.hbIndicator=0);var c="number"==typeof e.width?e.width:t.offsetWidth,s=("number"==typeof e.height?e.height:t.offsetHeight)-30,u=Math.min(20,(c-40)/o),d=u,h=(c-(o-1)*u)/2,f=Math.floor(Math.max(0,h-u/3)),p=Math.floor(Math.min((o-1)*u+2*u/3+4,c-f));t.innerHTML="";var m=new Canvas({id:"practice_canvas",width:c,height:s});t.appendChild(m.element);var v,g,b,y=function(){var n=document.createElement("div");n.className="practice_scoreboard",t.appendChild(n);var o=0,a=0;return{element:n,show:function(){e.score&&(n.className="practice_scoreboard visible")},hide:function(){n.className="practice_scoreboard"},reset:function(){o=a=0,n.innerHTML="Changes: "+o+"<br/>Errors: "+a},score:function(){return Math.max(0,o-a)+"/"+o+" ("+Math.max(0,Math.round(10*(100-100*a/o))/10)+"%)"},correct:function(){o++,n.innerHTML="Changes: "+o+"<br/>Errors: "+a},error:function(){a++,n.innerHTML="Changes: "+o+"<br/>Errors: "+a}}}(),x=(v={},["left","down","right"].forEach((function(e){v[e]=document.createElement("div"),v[e].className="practice_errorFlash_"+e,t.appendChild(v[e])})),function(e){v[e].className="practice_errorFlash_"+e,setTimeout((function(){v[e].className="error practice_errorFlash_"+e}),50)}),w=function(){var e=document.createElement("div");e.className="practice_pause",t.appendChild(e);var pauseFunction=function(){U=!1,F=!0,E.show(),w.hide(),y.hide(),_.deactivate()};return e.addEventListener("click",pauseFunction),"boolean"==typeof document.hidden&&document.addEventListener("visibilitychange",(function(){!0===document.hidden&&U&&pauseFunction()}),!1),{element:e,show:function(){e.className="practice_pause visible"},hide:function(){e.className="practice_pause"}}}(),E=function(){var n=document.createElement("div");if(n.className="practice_buttons visible",t.appendChild(n),"string"==typeof e.title&&""!==e.title){var o=document.createElement("h1");o.appendChild(document.createTextNode(e.title)),n.appendChild(o)}else n.style.height="50px";var resumeCallback=function(){U||(U=!0,F=!1,E.hide(),w.show(),_.activate(),y.show(),m.element.className="visible",draw())};e.buttons.unshift({text:"Start",callback:function(){setup(),resumeCallback()}}),e.buttons.unshift({text:"Resume",callback:resumeCallback});var a=e.buttons.map((function(e){var t=document.createElement("input");return t.value=e.text,t.type="button",t.className="string"==typeof e.className?e.className:"",n.appendChild(t),t.addEventListener("click",e.callback),t}));return{element:n,show:function(){D>0&&(a[1].value="Restart",a[0].style.display="inline-block"),(0===D||J)&&(a[0].style.display="none"),n.className="practice_buttons visible"},hide:function(){a.forEach((function(e){e.blur()})),n.className="practice_buttons"}}}(),_=((g=document.createElement("div")).className="practice_controls",t.appendChild(g),{element:g,deactivate:function(){g.className="practice_controls"},activate:function(){g.className="practice_controls active"}}),M=(b={},["left","down","right"].forEach((function(e){b[e]=document.createElement("div"),b[e].className="practice_controls_"+e,_.element.appendChild(b[e])})),function(e,t){b[e].className="practice_controls_"+e,setTimeout((function(){b[e].className=t+" practice_controls_"+e}),50)});if(e.hbIndicator)var fillTextCache_hbIndicator=function(e){var t=new Canvas({id:"cc"+e,width:16,height:16}),n=t.context,o=measureXAndYTextPadding(16,"12px Roboto, sans-serif",e);return n.fillStyle="#999",n.textAlign="center",n.textBaseline="middle",n.font="12px Roboto, sans-serif",n.fillText(e,8+o.x,8+o.y),h-u-8<f&&(p=Math.floor(p+f-(h-u-8)),f=Math.floor(Math.max(0,h-u-8))),t},I=fillTextCache_hbIndicator("H"),S=fillTextCache_hbIndicator("B");if("object"==typeof e.placeStarts)var k=function(){var t,a=new Canvas({id:"cc0",width:22*o,height:22}),r=a.context,i=measureXAndYTextPadding(16,"12px Roboto, sans-serif","0");r.strokeStyle=e.lines[l].color,r.fillStyle="#333",r.lineWidth=1.5,r.setLineDash([]),r.font="12px Roboto, sans-serif",r.textAlign="center",r.textBaseline="middle";for(var c=0;c<o;++c)t=22*(c+.5),r.fillText(n.bellToChar(c),t+i.x,11+i.y),r.beginPath(),r.arc(t,11,8,0,2*Math.PI,!0),r.closePath(),r.stroke();return p=Math.floor(Math.max(p,h+o*u+16-f)),a}();var A=function(){var e=new Canvas({id:"cc1",width:c,height:22}),t=e.context;t.fillStyle="#999",t.textAlign="center",t.textBaseline="middle",t.font="12px Roboto, sans-serif";for(var a=0;a<o;++a)t.fillText(n.bellToChar(a),h+a*u,11);return e}();if(e.introduction)var L=function(){var t=new Canvas({id:"cc2",width:c,height:90}),n=t.context;n.strokeStyle="rgba(255,255,255,0.8)",n.lineWidth=6,n.textAlign="center",n.textBaseline="middle","string"==typeof e.title&&(n.font="14px Roboto, sans-serif",n.fillStyle="#002856",n.strokeText(e.title.toUpperCase(),c/2,10),n.fillText(e.title.toUpperCase(),c/2,10)),n.font="13px Roboto, sans-serif",n.fillStyle="#333",n.strokeText("Use the arrow keys or tap the",c/2,40),n.strokeText("screen to navigate. Press 'Esc'",c/2,55),n.strokeText("or the 'X' above ↗ to pause.",c/2,70),n.fillText("Use the arrow keys or tap the",c/2,40),n.fillText("screen to navigate. Press 'Esc'",c/2,55),n.fillText("or the 'X' above ↗ to pause.",c/2,70);var o=n.measureText("screen to navigate. Press 'Esc'").width;return n.font="14px Roboto, sans-serif",o=Math.max(o,n.measureText(e.title.toUpperCase()).width),Math.floor((c-o)/2)<f&&(p=Math.max(o,p+f-Math.floor((c-o)/2)),f=Math.floor(Math.max(0,(c-o)/2))),p=Math.floor(Math.min(Math.max(p,c-f-(c-o)/2),c-f)),t}();if(e.thatsAll)var T=function(){var t=new Canvas({id:"cc3",width:c,height:40}),n=t.context;n.font="bold 15px Roboto, sans-serif",n.strokeStyle="rgba(255,255,255,0.8)",n.lineWidth=4,n.fillStyle="#333",n.textAlign="center",n.textBaseline="top";var o="string"==typeof e.thatsAll?e.thatsAll:"That's all!";return n.strokeText(o,c/2,0),n.fillText(o,c/2,0),t}(),R=!e.score;var N=function(){var t,n={byRow:[],canvases:[]},o=0,a=/^(\d+)\-(\d+)$/;for(var r in e.messages){r.split(",").forEach((function(e){var t=e.match(a);if(null!==t)for(var r=parseInt(t[1]),i=parseInt(t[2]);r<=i;)n.byRow[r]=o,++r;else isNaN(parseInt(e))||(n.byRow[parseInt(e)]=o)})),n.canvases[o]=new Canvas({id:"ccm"+o,width:c,height:40});var i=n.canvases[o].context;i.font="bold 12px Roboto, sans-serif",i.strokeStyle="rgba(255,255,255,0.8)",i.lineWidth=4,i.fillStyle="#333",i.textAlign="center",i.textBaseline="top",i.strokeText(e.messages[r],c/2,0),i.fillText(e.messages[r],c/2,0),++o,t=i.measureText(e.messages[r]).width,Math.floor((c-t)/2)<f&&(p=Math.max(t,p+f-Math.floor((c-t)/2)),f=Math.floor(Math.max(0,(c-t)/2))),p=Math.floor(Math.min(Math.max(p,c-f-(c-t)/2),c-f))}return n}(),B=function(){var t,n=[];for(var o in e.overlayMessages){n[o]=new Canvas({id:"ccom"+o,width:c,height:d});var a=n[o].context;a.font="bold 12px Roboto, sans-serif",a.strokeStyle="rgba(255,255,255,0.8)",a.lineWidth=4,a.fillStyle="#333",a.textAlign="center",a.textBaseline="middle",a.strokeText(e.overlayMessages[o],c/2,d/2),a.fillText(e.overlayMessages[o],c/2,d/2),++o,t=a.measureText(e.overlayMessages[o]).width,Math.floor((c-t)/2)<f&&(p=Math.max(t,p+f-Math.floor((c-t)/2)),f=Math.floor(Math.max(0,(c-t)/2))),p=Math.floor(Math.min(Math.max(p,c-f-(c-t)/2),c-f))}return n}(),O=[r.slice(0)];if(O.push(n.apply(a[0],O[0])),"number"==typeof i)for(;O.length<=i;)O.push(n.apply(a[(O.length-1)%a.length],O[O.length-1]));else for(;O.length<1e4&&!n.rowsEqual(i,O[O.length-1]);)O.push(n.apply(a[(O.length-1)%a.length],O[O.length-1]));var C,q,D,H,j,P,$,W=m.context,U=!1,F=!1,J=!1,setup=function(){C=O[0].indexOf(l),q=O[1].indexOf(l),D=0,H=0,j=s/2,P=null,$=0,y.reset(),R=!1,J=!1};setup();var advance=function(t){U&&(C=q,H++,$=D,e.score&&y.correct(),M(t,"success"),H+2>O.length?(U=!1,J=!0,E.show(),w.hide(),y.hide(),_.deactivate()):q=O[H+1].indexOf(l))},error=function(t){M(t,"error"),x(t),e.score&&y.error(),"object"==typeof Android&&Android.buzz()},Q=250,step=function(e){var t=!1;if(null===P&&(P=e,t=!0),!F){if(D<H){var n=Math.min(H-D,(P-e)/Q*((e-P)/Q-2)*(H-$));D=Math.min(H,D+n),j+=n*d,t=!0}j>s/2&&(j=Math.min(s-28-(N.byRow.length>0?20:0),Math.max(s/2,j-Math.max(.05,s/(10*Q)*(e-P)*Math.pow((j-s/2)/(s/2),2)))),t=!0),t&&draw()}P=e,window.requestAnimationFrame(step)};window.requestAnimationFrame(step);var draw=function(){var t,n,a,r,i,m,v,g,b=Math.ceil(D),x=Math.floor(D);for(W.clearRect(f,0,p,s),W.strokeStyle="#BBB",W.lineWidth=.5,W.setLineDash([4,3]),W.lineCap="butt",W.beginPath(),t=0;t<o;++t)W.moveTo(h+t*u,(j-D*d)%7),W.lineTo(h+t*u,s-22);if(W.stroke(),W.drawImage(A.element,0,s-22,c,22),"object"==typeof e.ruleOffs)for(r=1,W.lineWidth=1,W.setLineDash([3,1]),t=U?x+1:x;r>0&&t>0;--t)r=j-(x-t+D%1+.5)*d,(t-e.ruleOffs.from)%e.ruleOffs.every==0&&(W.strokeStyle=t==x+1?"rgba(153,153,153,"+Math.round(D%1*10)/10+")":"#999",W.beginPath(),W.moveTo(h-u/3,r),W.lineTo(h+(o-1)*u+u/3,r),W.stroke());if("object"==typeof e.placeStarts)for(a=h+o*u+5,r=1,t=U?b:b-(e.thatsAll?1:0);r>0&&t>=0;--t)r=j-(x-t+D%1+.5)*d,(t-e.placeStarts.from)%e.placeStarts.every==0&&(t==x+1&&(W.globalAlpha=D%1),W.drawImage(k.element,Math.floor(22*O[t].indexOf(l)*k.scale),0,Math.floor(22*k.scale),Math.floor(22*k.scale),a-11,r-11,22,22),t==x+1&&(W.globalAlpha=1));if(j-D*d>0&&e.introduction&&W.drawImage(L.element,0,j-D*d-120,c,90),J&&D>1&&e.thatsAll&&(!R&&e.score&&(T.context.clearRect(0," "===e.thatsAll?0:15,c,15),T.context.font="13px Roboto, sans-serif",T.context.fillText("Score: "+y.score(),c/2," "===e.thatsAll?5:20),R=!0),r=j+(1-(D%1==0?1:D%1))*d+20,W.globalAlpha=D%1==0?1:D%1,W.drawImage(T.element,0,r,c,40),W.globalAlpha=1),0!==e.hbIndicator&&(x%2==0&&1===e.hbIndicator||x%2==1&&-1===e.hbIndicator?(v=I.element,g=S.element):(g=I.element,v=S.element),D%1==0?W.drawImage(g,h-u-8,j-8,16,16):D%1>.66?W.drawImage(v,h-u-8,j-8,16,16):(W.globalAlpha=D%1/.66,W.drawImage(v,h-u-8,j-8,16,16),W.globalAlpha=1-D%1/.66,W.drawImage(g,h-u-8,j-8,16,16),W.globalAlpha=1)),D>0)for(W.setLineDash([]),W.lineCap="round",W.lineJoin="round",t=0;t<e.lines.length;++t)if(null!==e.lines[t]&&"string"==typeof e.lines[t].color){for(i=O[x].indexOf(t),m=O[b].indexOf(t),a=h+u*(D==b?m:i+D%1*(m-i)),r=j,W.strokeStyle=e.lines[t].color,W.lineWidth=e.lines[t].width,W.beginPath(),W.moveTo(a,r),W.lineTo(a=h+u*(D==b?m:i),r-=(D-x)*d),n=1;void 0!==O[x-n]&&r>0;n++)a=h+u*O[x-n].indexOf(t),W.lineTo(a,r-=d);W.stroke()}if(i=O[x].indexOf(l),m=O[b].indexOf(l),a=h+u*(D==b?m:i+D%1*(m-i)),r=j,W.fillStyle=e.lines[l].color,W.beginPath(),W.arc(a,r,4,0,2*Math.PI,!0),W.closePath(),W.fill(),N.byRow.length>0&&(void 0!==N.byRow[x]||void 0!==N.byRow[b])&&(N.byRow[b]===N.byRow[x]?W.drawImage(N.canvases[N.byRow[x]].element,0,j+15,c,40):(void 0!==N.byRow[b]&&(W.globalAlpha=D%1,W.drawImage(N.canvases[N.byRow[b]].element,0,j+15,c,40)),void 0!==N.byRow[x]&&(W.globalAlpha=1-D%1,W.drawImage(N.canvases[N.byRow[x]].element,0,j+15,c,40)),W.globalAlpha=1)),B.length>0){var w=Math.max(0,Math.floor((D*d-j)/d)),E=Math.ceil(Math.min(D+3,(s-j+D*d)/d));for(t=w;t<E;++t)void 0!==B[t]&&(t+1>=E&&D%1>0?(W.globalAlpha=D%1,W.drawImage(B[t].element,0,j-(1.5+D-t)*d,c,d),W.globalAlpha=1):W.drawImage(B[t].element,0,j-(1.5+D-t)*d,c,d))}},left=function(){U&&(q-C<=-1?advance("left"):error("left"))},down=function(){U&&(q-C==0?advance("down"):error("down"))},right=function(){U&&(q-C>=1?advance("right"):error("right"))};document.body.addEventListener("keydown",(function(e){if(U)switch(e.key){case"ArrowLeft":e.preventDefault(),left();break;case"ArrowDown":e.preventDefault(),down();break;case"ArrowRight":e.preventDefault(),right();break;case"Shift":Q=2500;break;case"Escape":case" ":e.preventDefault(),w.element.dispatchEvent(new Event("click"))}})),document.body.addEventListener("keyup",(function(e){U&&"Shift"===e.key&&(Q=250)})),t.addEventListener("touchstart",(function(e){var n=e.touches[0],o=t.getBoundingClientRect(),a=(n.clientX-o.left)/o.width;U&&n.pageY-o.top>30&&(e.preventDefault(),a<=.33?left():a>=.66?right():down())})),t.addEventListener("click",(function(e){var t=e.target.className.split(/\s+/);-1!==t.indexOf("practice_controls_left")?left():-1!==t.indexOf("practice_controls_down")?down():-1!==t.indexOf("practice_controls_right")&&right()})),e.autostart&&!U&&(U=!0,F=!1,setup(),E.hide(),w.show(),_.activate(),y.show(),m.element.className="visible",draw())};ready((function(){document.getElementById("go").addEventListener("click",(function(e){var t,o=document.getElementById("practice_container");o.innerHTML="",o.replaceWith(o.cloneNode(!0));var a=document.getElementById("practice_chooser_name").value,r=document.querySelector("#practice_chooser_leadOrCourse li.active input").value,i=parseInt(document.getElementById("practice_chooser_stage").value,10),l=n.parse(n.expand(document.getElementById("practice_chooser_notation").value,i),i),c=parseInt(practice_chooser_bell.querySelector("li.active input").value,10)-1,s={};try{s=JSON.parse(document.getElementById("practice_chooser_ruleOffs").value)}catch(e){s={from:0,every:l.length}}var u=Array(i),d=n.huntBells(l,i);for(t=0;t<i;++t)u[t]=-1!==d.indexOf(t)?{color:"#D11",width:2}:null;u[c]={color:-1!==d.indexOf(c)?"#D11":"#11D",width:4},new RingingPractice({container:"practice_container",title:a,stage:i,notation:l,following:c,lines:u,ruleOffs:s,introduction:!0,score:!0,thatsAll:"course"===r?"That's all!":" ",finishRow:"course"!==r&&l.length,placeStarts:{from:0,every:l.length},autostart:!0,buttons:[{text:"↑ Exit",className:"plain",callback:function(){document.querySelector("#tutor .prev_button button").dispatchEvent(new Event("click",{bubbles:!0}))}}]})}))})),ready((function(){e.load(),Hash_read()}))}();